ymaps.ready(init);
            
function init() {
    var map = new ymaps.Map("map", {
        center: [41.27060103232188, 69.20635608472475], // Chilonzor centre
        zoom: 12,
        controls: []
    });

    var neighborhoods = {
        al_xorazmiy: createDistrictPolygon(
            [[41.263111, 69.154577],
            [41.262172, 69.154942],
            [41.260505, 69.155575],
            [41.260246, 69.154480],
            [41.260254, 69.154255],
            [41.259485, 69.152818],
            [41.260318, 69.151712],
            [41.259412, 69.150414],
            [41.260691, 69.149620],
            [41.261492, 69.150071],
            [41.262019, 69.151616],
            [41.262440, 69.152818],
            [41.262998, 69.154556]],
            "Al Xorazmiy mahalla", "12.34"
        ),
        katta_xirmontepa: createDistrictPolygon(
            [[41.271467, 69.177231],
            [41.270593, 69.178057],
            [41.269872, 69.178744],
            [41.269370, 69.179484],
            [41.268286, 69.181243],
            [41.268156, 69.181222],
            [41.268043, 69.181077],
            [41.267294, 69.180385],
            [41.267500, 69.180069],
            [41.267051, 69.179344],
            [41.266671, 69.178685],
            [41.266165, 69.177837],
            [41.265554, 69.176737],
            [41.266051, 69.175831],
            [41.266816, 69.174527],
            [41.267067, 69.174157],
            [41.267905, 69.173245],
            [41.268860, 69.172199],
            [41.270985, 69.175654],
            [41.271167, 69.176075],
            [41.271335, 69.176761],
            [41.271458, 69.177227],],
            "Katta Xirmontepa", "22.3"
        ) ,
        qizil_sharq: createDistrictPolygon(
            [[41.268786, 69.164141],
            [41.268580, 69.164860],
            [41.268341, 69.165745],
            [41.268065, 69.166729],
            [41.267709, 69.168016],
            [41.267580, 69.168499],
            [41.267434, 69.168880],
            [41.267175, 69.169293],
            [41.267001, 69.169373],
            [41.265945, 69.168263],
            [41.263601, 69.165731],
            [41.265225, 69.163120],
            [41.265225, 69.163120],
            [41.265477, 69.163428],
            [41.265787, 69.162908],
            [41.266014, 69.162792],
            [41.266329, 69.162674],
            [41.266689, 69.162267],
            [41.267046, 69.162642],
            [41.267515, 69.163028],
            [41.268094, 69.163458],
            [41.268094, 69.163458],
            [41.268690, 69.163939],
            [41.268770, 69.164136],],
            "Qizil Sharq", "2.3"
        ),
        sharq_tongi: createDistrictPolygon(
            [[41.267794, 69.167795],
            [41.267988, 69.167988],
            [41.268847, 69.169415],
            [41.269842, 69.171164],
            [41.268126, 69.172988],
            [41.266548, 69.170520],
            [41.266046, 69.171131],
            [41.265406, 69.172784],
            [41.261561, 69.169007],
            [41.261188, 69.168717],
            [41.260662, 69.168578],
            [41.260784, 69.166389],
            [41.260826, 69.166220],
            [41.261039, 69.165815],
            [41.262128, 69.164083],
            [41.264580, 69.166733],
            [41.266993, 69.169383],
            [41.266993, 69.169383],
            [41.267794, 69.167800],
            [41.268009, 69.168015],],
            "Sharq tongi", "0.9"
        ),
        sharaf: createDistrictPolygon(
            [[41.265478, 69.160267],
            [41.266220, 69.161626],
            [41.266435, 69.161978],
            [41.266682, 69.162280],
            [41.266309, 69.162679],
            [41.265773, 69.162929],
            [41.265487, 69.163419],
            [41.265302, 69.163248],
            [41.265228, 69.163119],
            [41.263603, 69.165732],
            [41.262112, 69.164110],
            [41.263153, 69.162368],
            [41.263443, 69.161990],
            [41.263823, 69.161661],
            [41.264534, 69.161042],
            [41.265462, 69.160267]],
            "sharaf", '0.6'
        ),
        qozirobod: createDistrictPolygon(
            [[41.274458, 69.204741],
            [41.275934, 69.205942],
            [41.277502, 69.207386],
            [41.279242, 69.209208],
            [41.282123, 69.212392],
            [41.282123, 69.212392],
            [41.282123, 69.212392],
            [41.282123, 69.212392],
            [41.270781, 69.222918],
            [41.269550, 69.221776],
            [41.269036, 69.221724],
            [41.268185, 69.221147],
            [41.267116, 69.220806],
            [41.266562, 69.220465],
            [41.266027, 69.219756],
            [41.266106, 69.219363],
            [41.266106, 69.219363],
            [41.274396, 69.204833]],
            "Qozirobod", '8.6'
        ),
        gavhar: createDistrictPolygon(
            [[41.270166, 69.211441],
            [41.265478, 69.218638],
            [41.265136, 69.218270],
            [41.263662, 69.218553],
            [41.262359, 69.218213],
            [41.259516, 69.216104],
            [41.259257, 69.213915],
            [41.260731, 69.212113],
            [41.263419, 69.212671],
            [41.263710, 69.210032],
            [41.262933, 69.208701],
            [41.263532, 69.206985],
            [41.263532, 69.206985],
            [41.270108, 69.211291]],
            "gavhar", '5.6'
        ),
        dombirobod: createDistrictPolygon(
            [[41.254520, 69.203820],
            [41.260123, 69.205275],
            [41.263474, 69.207036],
            [41.262934, 69.208796],
            [41.259430, 69.208186],
            [41.263454, 69.212650],
            [41.260759, 69.212114],
            [41.259276, 69.213823],
            [41.258429, 69.211680],
            [41.256465, 69.208337],
            [41.255155, 69.206091],
            [41.254501, 69.204025]],
            "Do'mbirobod", '4.5'
        ),
        katta_dombirobod: createDistrictPolygon(
            [[41.271892, 69.208884],
            [41.270186, 69.211354],
            [41.263158, 69.206892],
            [41.260330, 69.205410],
            [41.254421, 69.203823],
            [41.254262, 69.202173],
            [41.254389, 69.195718],
            [41.261891, 69.203155],
            [41.258621, 69.195866],
            [41.260554, 69.196734],
            [41.259851, 69.198469],
            [41.266637, 69.202321],
            [41.267292, 69.203527],
            [41.269171, 69.206909],
            [41.269493, 69.207151],
            [41.270485, 69.207291],
            [41.270833, 69.207498],
            [41.271841, 69.208673]],
            "katta do'mbirobod", '4.7'
        ),
        naqqoshlik: createDistrictPolygon(
            [[41.259899, 69.198370],
            [41.260537, 69.196750],
            [41.264427, 69.198856],
            [41.269447, 69.201577],
            [41.272921, 69.203513],
            [41.274507, 69.204652],
            [41.271904, 69.208682],
            [41.270698, 69.207385],
            [41.269335, 69.207084],
            [41.268321, 69.205415],
            [41.266956, 69.202729],
            [41.266575, 69.202330],
            [41.260011, 69.198606]],
            "Naqqoshlik", '3.5'
        ),
        mevazor: createDistrictPolygon(
            [[41.269162, 69.192983],
            [41.268994, 69.193799],
            [41.267876, 69.193343],
            [41.267438, 69.194546],
            [41.266985, 69.194525],
            [41.267000, 69.195447],
            [41.266868, 69.195862],
            [41.267104, 69.196001],
            [41.266844, 69.196781],
            [41.266776, 69.196751],
            [41.266296, 69.198275],
            [41.266363, 69.198787],
            [41.266040, 69.199721],
            [41.262903, 69.198030],
            [41.263155, 69.197114],
            [41.263099, 69.196997],
            [41.263150, 69.196409],
            [41.262846, 69.195992],
            [41.262524, 69.195146],
            [41.262487, 69.194867],
            [41.263035, 69.193799],
            [41.263008, 69.193408],
            [41.262671, 69.192759],
            [41.263846, 69.189715],
            [41.268005, 69.192473],
            [41.269128, 69.192963]],
            "Mevazor", '6.7'
        ),
        borijar: createDistrictPolygon(
            [[41.270645, 69.192098],
            [41.270446, 69.192392],
            [41.270201, 69.193368],
            [41.267980, 69.192469],
            [41.262533, 69.188798],
            [41.261541, 69.188863],
            [41.261249, 69.189240],
            [41.261127, 69.189082],
            [41.261089, 69.188542],
            [41.260916, 69.187728],
            [41.261292, 69.187623],
            [41.262577, 69.187585],
            [41.264594, 69.188630],
            [41.266970, 69.189943],
            [41.270633, 69.192040]],
            "Bo'rijar", '5.6'
        ),
        shuhrat: createDistrictPolygon(
            [[41.267720, 69.182608],
            [41.268427, 69.183913],
            [41.268759, 69.183852],
            [41.269963, 69.182589],
            [41.270925, 69.184439],
            [41.269871, 69.185485],
            [41.270042, 69.185800],
            [41.268776, 69.187129],
            [41.268313, 69.188623],
            [41.268280, 69.188947],
            [41.267843, 69.190450],
            [41.264811, 69.188716],
            [41.265674, 69.186028],
            [41.266077, 69.185284],
            [41.266722, 69.184428],
            [41.267426, 69.183506],
            [41.267681, 69.182675]],
            "shuhrat", '5.7'
        ),
        yakkatut: createDistrictPolygon(
            [[41.265570, 69.176730],
            [41.266655, 69.178693],
            [41.267513, 69.180067],
            [41.267302, 69.180367],
            [41.268055, 69.181086],
            [41.268135, 69.181118],
            [41.268269, 69.181253],
            [41.267723, 69.182524],
            [41.267537, 69.183189],
            [41.267391, 69.183521],
            [41.266703, 69.184444],
            [41.266104, 69.185206],
            [41.265837, 69.185624],
            [41.265586, 69.186225],
            [41.264809, 69.188661],
            [41.264602, 69.183258],
            [41.261487, 69.187609],
            [41.262819, 69.182556],
            [41.263185, 69.181220],
            [41.263749, 69.180034],
            [41.265539, 69.176748]],
            "Yakatut", '4.6'
        ),
        kichik_xirmontepa: createDistrictPolygon(
            [[41.272783, 69.182889],
            [41.273883, 69.187590],
            [41.271441, 69.189964],
            [41.270844, 69.191776],
            [41.270685, 69.192043],
            [41.267843, 69.190422],
            [41.268290, 69.188935],
            [41.268325, 69.188582],
            [41.268707, 69.187256],
            [41.268866, 69.187002],
            [41.270041, 69.185807],
            [41.269869, 69.185482],
            [41.272459, 69.183051],
            [41.272523, 69.182999],
            [41.272632, 69.182944],
            [41.272784, 69.182865]],
            "Kichik xirmontepa", '4.6'
        ),
        xontopi: createDistrictPolygon(
            [[41.260646, 69.168526],
            [41.261198, 69.168726],
            [41.261577, 69.169021],
            [41.263386, 69.170792],
            [41.265235, 69.172585],
            [41.265588, 69.173065],
            [41.265348, 69.173753],
            [41.265117, 69.174113],
            [41.264853, 69.174409],
            [41.264718, 69.174473],
            [41.264079, 69.175266],
            [41.262163, 69.177234],
            [41.261340, 69.178441],
            [41.261181, 69.179224],
            [41.261045, 69.179604],
            [41.260614, 69.181922],
            [41.260496, 69.182920],
            [41.260483, 69.183347],
            [41.262196, 69.173592],
            [41.259457, 69.182779],
            [41.259967, 69.180091],
            [41.260056, 69.179328],
            [41.260176, 69.177068],
            [41.260461, 69.171950],
            [41.260645, 69.168562]],
            "Xonto'pi", '6.8'
        ),
        beshqorgon: createDistrictPolygon(
            [[41.253175, 69.159924],
            [41.254361, 69.161039],
            [41.253825, 69.167476],
            [41.254197, 69.167640],
            [41.253970, 69.170622],
            [41.253280, 69.170573],
            [41.253150, 69.176685],
            [41.253290, 69.178575],
            [41.254629, 69.182884],
            [41.254747, 69.185310],
            [41.254573, 69.185732],
            [41.254051, 69.185502],
            [41.252689, 69.186962],
            [41.250370, 69.183351],
            [41.240948, 69.193453],
            [41.240455, 69.194375],
            [41.236241, 69.187911],
            [41.222569, 69.174521],
            [41.225171, 69.171936],
            [41.226145, 69.171797],
            [41.227151, 69.173867],
            [41.227440, 69.173749],
            [41.228310, 69.174088],
            [41.230547, 69.172192],
            [41.234807, 69.168694],
            [41.235732, 69.165753],
            [41.235578, 69.164790],
            [41.235871, 69.164561],
            [41.236724, 69.165471],
            [41.236724, 69.165471],
            [41.239888, 69.166664],
            [41.239888, 69.166664],
            [41.249848, 69.163505],
            [41.249848, 69.163505],
            [41.253330, 69.159727]],
            "Beshqo'rg'on", '6.9'
        ),
        yakkabog: createDistrictPolygon(
            [[41.263891, 69.189697],
            [41.262708, 69.192739],
            [41.263045, 69.193448],
            [41.263024, 69.193872],
            [41.262560, 69.194665],
            [41.262498, 69.195021],
            [41.262880, 69.195978],
            [41.263126, 69.196376],
            [41.263104, 69.196871],
            [41.263171, 69.197137],
            [41.262904, 69.198020],
            [41.259037, 69.195935],
            [41.254396, 69.195723],
            [41.254356, 69.191428],
            [41.253836, 69.188831],
            [41.252689, 69.186904],
            [41.254001, 69.185502],
            [41.254433, 69.185557],
            [41.259090, 69.188477],
            [41.259352, 69.188412],
            [41.260950, 69.187700],
            [41.261138, 69.188621],
            [41.261138, 69.189073],
            [41.261233, 69.189231],
            [41.261539, 69.188826],
            [41.262457, 69.188788],
            [41.263804, 69.189707]],
            "Yakkabog'", '6.5'
        )
    }

    for (var key in neighborhoods) {
        if (neighborhoods.hasOwnProperty(key)) {
            map.geoObjects.add(neighborhoods[key].polygon);
        }
    }
    
    // Poligon yaratish uchun yordamchi funksiya
    function createDistrictPolygon(coordinates, name, area) {
        var polygon = new ymaps.Polygon([coordinates], {
            balloonContent: `
                <div style="padding: 5px;">
                    <b class='text-uppercase'>${name}</b><br>
                    <small>Hudud: ${area}</small>                                        
                </div>
            `,
            hintContent: name
        }, {
            fillColor: '#000080',
            strokeColor: '#800000',
            strokeWidth: 1,
            fillOpacity: 0.2
        });
        
        return {
            polygon: polygon,
            name: name,
            area: area
        };
    }

    var chilonzorBorders = [
        [41.22828451770735, 69.17974875085794],
        [41.229220520389866, 69.17529091969745],
        [41.22966027564416, 69.17376206063518],
        [41.23037840171874, 69.17276427893138],
        [41.23420289541749, 69.16956708572467],
        [41.2347596068482, 69.1689769997708],
        [41.23519529079133, 69.16803286210023],
        [41.23576006189457, 69.16577980664005],
        [41.23576006190187, 69.16462109230015],
        [41.23639744057159, 69.16528628010269],
        [41.23703481302622, 69.16557595866185],
        [41.23806750459672, 69.16564033167928],
        [41.238680657480806, 69.16576907770558],
        [41.23935834608159, 69.16648790968574],
        [41.2399069460257, 69.16679904592077],
        [41.24167897167312, 69.16671573743692],
        [41.24899008459856, 69.16426327554163],
        [41.25068583341618, 69.1631626110972],
        [41.251879614132186, 69.16198977198398],
        [41.25299198107476, 69.16049214665478],
        [41.259285993460985, 69.15076660334589],
        [41.26100860229474, 69.14899832283672],
        [41.26336926275403, 69.1555604137001],
        [41.26421605234161, 69.15785102008462],
        [41.26487734708744, 69.15913848058729],
        [41.266405557434105, 69.16194407116129],
        [41.26698618735296, 69.16262535225401],
        [41.268582892985194, 69.16377333769182],
        [41.26880062254248, 69.16412738926412],
        [41.26780067339862, 69.16779665116046],
        [41.26801840556441, 69.16799513461766],
        [41.26802243763473, 69.16799513461766],
        [41.269877163594735, 69.17112259030286],
        [41.268861102869096, 69.17218474501979],
        [41.270856921478774, 69.17538730262217],
        [41.27123591852043, 69.17621342295757],
        [41.271534276360086, 69.17735067968427],
        [41.27281639313764, 69.18285993697978],
        [41.274300069175666, 69.18918458581108],
        [41.27533217175353, 69.19324545027818],
        [41.2756466372802, 69.1943451560313],
        [41.276041732816616, 69.19475821619899],
        [41.27673112848472, 69.1959115660179],
        [41.27784785343446, 69.19711319580294],
        [41.278883931291716, 69.19801978240477],
        [41.2810558313198, 69.19450572003159],
        [41.29216057085208, 69.19405053411008],
        [41.30292147162992, 69.19368638532073],
        [41.30055057822702, 69.20112108902738],
        [41.30068736289146, 69.21890368710748],
        [41.3013940790368, 69.2209975424371],
        [41.30200959976224, 69.22230240880195],
        [41.30200959976224, 69.22369831235504],
        [41.29954748200343, 69.23155785627348],
        [41.31007922301885, 69.24020638970747],
        [41.31169758669414, 69.24035811883263],
        [41.31106506209144, 69.25998801375972],
        [41.310355601502, 69.25962007179056],
        [41.310147605568474, 69.25893729287873],
        [41.30928141524495, 69.25843949809008],
        [41.307576905497726, 69.25691063902781],
        [41.30429267709042, 69.25371344587128],
        [41.30334969012798, 69.25353642004823],
        [41.30286610178761, 69.25285513893301],
        [41.30224381988155, 69.25212565261283],
        [41.30225340478353, 69.25147495337013],
        [41.30165194930966, 69.25099649808733],
        [41.30117269792767, 69.25013846819478],
        [41.30079887942156, 69.24912414299523],
        [41.300103954691224, 69.24828525130633],
        [41.29725718124607, 69.24207171189504],
        [41.29507161919173, 69.24166343005372],
        [41.29488948571497, 69.24056617260513],
        [41.29383501874932, 69.24011961434118],
        [41.29297226026907, 69.2388947687236],
        [41.2917356200291, 69.23769544081469],
        [41.28966491411592, 69.23800165219569],
        [41.287038090669725, 69.23676404780944],
        [41.28636698744881, 69.23507988521395],
        [41.28534543538795, 69.23500942139523],
        [41.28511174238037, 69.23523907993098],
        [41.284898580778375, 69.23517718144356],
        [41.28441544175085, 69.23486993092249],
        [41.28381115663907, 69.23493251898623],
        [41.282041025132926, 69.23469923617769],
        [41.28137400659504, 69.23464044132363],
        [41.28111603392923, 69.23452285162216],
        [41.280158248013485, 69.23288797537246],
        [41.2801140640968, 69.23203260507847],
        [41.279464129502486, 69.2310406789988],
        [41.27924178196721, 69.23007530542091],
        [41.27848208885381, 69.22939631970048],
        [41.277877748801, 69.22863388321704],
        [41.2755201989824, 69.22600328767273],
        [41.273233835941284, 69.22466428228117],
        [41.27175136326917, 69.22328355151662],
        [41.27021753880102, 69.22253249469472],
        [41.269399294256715, 69.22162591598506],
        [41.268874700046375, 69.2215045330674],
        [41.26820469584959, 69.22115935035545],
        [41.26670215083998, 69.22057519503944],
        [41.265852499066625, 69.2196079248451],
        [41.26527940557002, 69.21898204417592],
        [41.26512543929586, 69.21923618965977],
        [41.26441547898111, 69.21839030239262],
        [41.26291854942557, 69.21847375314812],
        [41.261772305886375, 69.21789718427392],
        [41.26047206496376, 69.21662266356807],
        [41.258997857008126, 69.21567435947827],
        [41.2577317795156, 69.21528365818884],
        [41.25628032263756, 69.21430880159373],
        [41.255641557317375, 69.21393706640487],
        [41.25403606158034, 69.21446432346397],
        [41.25323564020067, 69.2153870971996],
        [41.23636562314215, 69.18855516076857],
        [41.228289206149164, 69.17985260992957]
    ];

    var myPolygon = new ymaps.Polygon([chilonzorBorders], {}, {
        strokeColor: '#008000',
        strokeWidth: 3,
        fillOpacity: 0
    });
    
    map.geoObjects.add(myPolygon);
    // console.log(data2.map(x => console.log(x['Содир этилган жиноятнинг локацияси'])))
    const crimeMarkers = data2.map(item => {
        if (item['Содир этилган жиноятнинг локацияси']){
            const coords = item["Содир этилган жиноятнинг локацияси"].split(',').map(coord => parseFloat(coord.trim()));
            return {
                coords: coords,
                title: `Жиноят: ${item["Ҳужжат id"]}`,
                color: "red"
            };
        }        
    });

    crimeMarkers.forEach(function (point) {
        var placemark = new ymaps.Placemark(point.coords, {
            hintContent: point.title,
            balloonContent: point.title
        }, {
            preset: point.color === "red" ? 'islands#redIcon' : 'islands#blueIcon'
        });
    
        map.geoObjects.add(placemark);
    });
}
