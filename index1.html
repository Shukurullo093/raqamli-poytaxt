<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raqamli Poytaxt</title>
    <link rel="stylesheet" href="offline_modules/bootstrap-5.3.6-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="offline_modules/fontawesome-free-6.7.2-web/css/all.min.css">
    <script src="offline_modules/yandex-map" type="text/javascript"></script>
    <script src="offline_modules/bootstrap-5.3.6-dist/js/bootstrap.bundle.min.js"></script>
    <script src="offline_modules/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="js/data2.js"></script>
    <script src="js/data3.js"></script>
    <script src="js/other.js"></script>
    <script src="js/chilonzor-map.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --sidebar-bg: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a202c 100%);
            color: var(--text-primary);
            overflow-x: hidden;
        }
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            /* height: 20px; */
            /* background-color: #333; */
            color: white;
            text-align: end;
            font-size: 22px;
            /* line-height: 60px; */
        }
        footer .d-flex{
            background-color: #333;
            width: max-content;
            margin-left: auto;
            color: white;
        }
        /* Header Styles */
        .header {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
        }

        .logo {
            height: 50px;
            filter: brightness(1.2);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            margin-top: 70px;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: -15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        .nav-item {
            margin: 0.5rem 1rem;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            position: relative;
            z-index: 100;
            /* overflow: hidden; */
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-color);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.3);
        }

        .nav-item-icon {
            display: inline-block;
            width: 20px;
            margin-right: 1rem;
            text-align: center;
            color: var(--accent-color);
        }

        .nav-item-text {
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .nav-item-text {
            opacity: 0;
        }

        .sidebar.collapsed .nav-item {
            margin: 0.5rem 0.25rem;
            padding: 0.75rem;
            text-align: center;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: rgba(15, 23, 42, 0.5);
        }

        /* Card Styles */
        .dashboard-card {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: rgba(30, 41, 59, 0.5);
        }
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .card-body {
            padding: .5rem;
            height: calc(100vh - 200px);
            overflow-y: auto;
            position: relative;
        }
        .districts {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 100;
            background-color: var(--card-bg);
            padding: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        .statistics {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 100;
            background-color: var(--card-bg);
            padding: 10px;
            border-radius: 5px;
            overflow: hidden;
            min-width: 350px;
            max-width: 350px;
            min-height: 650px;
        }
        .districts li{
            padding: 5px 10px;
            border-radius: 5px;
            background-color: var(--border-color);
            margin: 5px 0;
        }
        .districts li:hover{
            transform: translateX(-5px);
            cursor: pointer;

        }

        /* Map Styles */
        #Tmap {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            position: relative;
            border-radius: 5px;
            overflow: hidden;
        }

        .map-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .overlay-card {
            margin-top: 55px;
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 0.3rem;
            border: 1px solid var(--border-color);
            min-width: 200px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Progress Circles */
        .progress-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .circle {
            position: relative;
            width: 60px;
            height: 60px;
        }

        .circle svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .circle-bg {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 4;
        }

        .circle-bar {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 4;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .circle-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .sidebar {
            animation: slideInLeft 0.5s ease;
        }

        .content-area {
            animation: slideInRight 0.5s ease;
        }

        .dashboard-card {
            animation: fadeInUp 0.6s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 1001;
                height: 100vh;
            }

            .sidebar.open {
                left: 0;
            }

            .content-area {
                margin-left: 0;
                padding: 1rem;
            }

            .header {
                padding: 0 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Chart Styles */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        /* List Styles */
        .custom-list {
            list-style: none;
            padding: 0;
        }

        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .list-item:hover {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-color);
        }

        /* Utility Classes */
        .text-gradient {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .glass-effect {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .platform-card {
        padding: 1.5rem;
        border-radius: 12px;
        color: white;
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .platform-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .platform-icon {
        width: 60px;
        height: 60px;
        margin-bottom: 1rem;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid rgba(255,255,255,0.2);
    }

    .alert {
        background: rgba(245, 158, 11, 0.1);
        border-left: 4px solid var(--accent-color);
    }

    .badge {
        font-weight: 500;
        padding: 0.35em 0.65em;
    }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="d-flex align-items-center">
            <a href="index.html"><img src="./stat-crm/images/iib_logo.png" class="logo" alt="Logo"></a>
            <button class="btn btn-link text-light d-md-none ms-2" id="sidebarToggleMobile">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <h1 class="header-title">Рақамли Пойтахт</h1>
        <div class="user-info">
            <i class="fas fa-language fs-5"></i>
            <img src="./m24-admin/images/avatar.jpg" alt="User" class="avatar">
            <span class="d-none d-md-inline">Тоштемиров Б.</span>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <div class="p-3">
                <div class="nav-item" data-card="mapCard">
                    <i class="nav-item-icon fas fa-map-marker-alt"></i>
                    <span class="nav-item-text">Рақамли хавфсиз маҳалла</span>
                </div>
                
                <div class="nav-item" data-card="crime">
                    <i class="nav-item-icon fas fa-exclamation-triangle"></i>
                    <span class="nav-item-text" data-bs-toggle="dropdown" aria-expanded="false">Жиноятчилик</span>
                </div>
                
                <div class="nav-item" data-card="demographic">
                    <i class="nav-item-icon fas fa-users"></i>
                    <span class="nav-item-text">Демографик маълумотлар</span>
                </div>
                
                <div class="nav-item active" data-card="monitoring">
                    <i class="nav-item-icon fas fa-chart-line"></i>
                    <span class="nav-item-text">Хавф мониторинги</span>
                </div>
                
                <div class="nav-item" data-card="personal">
                    <i class="nav-item-icon fas fa-user-shield"></i>
                    <span class="nav-item-text">Шахсий назорат</span>
                </div>
                
                <div class="nav-item" data-card="maHuq">
                    <i class="nav-item-icon fas fa-gavel"></i>
                    <span class="nav-item-text">Маъмурий ҳуқуқбузарликлар</span>
                </div>
                
                <div class="nav-item" data-card="e-ma-mo">
                    <i class="nav-item-icon fas fa-envelope"></i>
                    <span class="nav-item-text">E-материал мониторинги</span>
                </div>
                
                <div class="nav-item" data-card="prophylactic">
                    <i class="nav-item-icon fas fa-shield-alt"></i>
                    <span class="nav-item-text">Профилактик тадбирлар</span>
                </div>
                
                <div class="nav-item" data-card="statistic">
                    <i class="nav-item-icon fas fa-th-large"></i>
                    <span class="nav-item-text">Таркибий платформалар</span>
                </div>
            </div>
        </aside>

        <!-- Content Area -->
        <main class="content-area">
            <!-- Map Card -->
            <div class="dashboard-card d-none" id="mapCard">
                <div class="card-header">
                    <h2 class="card-title">Рақамли хавфсиз маҳалла</h2>
                </div>
                <div class="card-body">
                    <div id="Tmap" style="height: 100%; border-radius: 12px;"></div>
                    
                  <script>
                    ymaps.ready(init);
            
                    function init() {
                        var map = new ymaps.Map("Tmap", {
                            center: [41.311649232954316, 69.24125933467975], // Toshkent markazi
                            zoom: 12,
                            controls: ['zoomControl', 'typeSelector', 'fullscreenControl']
                        });

                        var polygonCoordinates = [
                            [41.397959470975074, 69.23403486321702],
                            [41.357255685865226, 69.16811689682896],
                            [41.333027425069545, 69.1626237329633],
                            [41.310744371279036, 69.15180162417637],
                            [41.28006679416332, 69.14726476493163],
                            [41.266001416392456, 69.14669765752605],
                            [41.24894841080359, 69.16257666488261],
                            [41.229758457888266, 69.17335170558883],
                            [41.227199371794676, 69.18469385370067],
                            [41.22762589309935, 69.19887153884045],
                            [41.23189095311937, 69.20567682770755],
                            [41.24169953525792, 69.21361633138581],
                            [41.244980557233994, 69.27014669867877], // 41.244980557233994, 69.27014669867877
                            [41.24340522537849, 69.31456144958106],
                            [41.23786156971283, 69.32136673844816],
                            [41.23786156971283, 69.32760491990967],
                            [41.248522028619945, 69.35255764575568], 
                            [41.26770647207268, 69.36503400867869],
                            [41.26813272903575, 69.36616822348988],
                            [41.290720365750985, 69.357661612406],
                            [41.30648445947063, 69.33951417542708],
                            [41.333743085290884, 69.37807747900729],
                            [41.33459473363532, 69.37807747900729],
                            [41.341407519542706, 69.37580904938494],
                            [41.35503095343275, 69.3440510346718],
                            [41.36950272840403, 69.32476938288171],
                            [41.36907713389997, 69.3259035976929],
                            [41.38524776780425, 69.31626277179784],
                            [41.38397128498231, 69.28337054227356],
                            [41.39716039908299, 69.26068624604989],
                            [41.397585809826694, 69.23516641279829]
                        ];

                        var myPolygon = new ymaps.Polygon([polygonCoordinates], {}, {
                            strokeColor: '#008000',
                            strokeWidth: 3,
                            fillOpacity: 0
                        });
                       
                        map.geoObjects.add(myPolygon);
                    }
                
                </script>

                    <!-- Map Overlays -->
                    <!-- <div class="map-overlay">
                        <div class="overlay-card">
                            <h6 class="text-gradient mb-2">Камералар</h6>
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <i class="fas fa-video text-primary"></i>
                                <span>Видеокузатув: <strong>806</strong></span>
                            </div>
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <i class="fas fa-user-check text-success"></i>
                                <span>FaceID: <strong>3509</strong></span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <i class="fas fa-camera text-warning"></i>
                                <span>PTZ: <strong>51</strong></span>
                            </div>
                        </div>
            
                        <div class="overlay-card">
                            <h6 class="text-gradient mb-2">Хавфсизлик кўрсатгичи</h6>
                            <div class="progress-wrapper">
                                <div class="circle">
                                    <svg>
                                        <circle class="circle-bg" cx="30" cy="30" r="25" />
                                        <circle class="circle-bar" cx="30" cy="30" r="25" 
                                                style="stroke-dasharray: 157; stroke-dashoffset: 15.7;" />
                                    </svg>
                                    <div class="circle-text">95%</div>
                                </div>
                                <div>
                                    <div class="fw-bold">Умумий хавфсизлик</div>
                                    <small class="text-success">+2.5% бугунги кунда</small>
                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>

            <!-- Crime Card -->
            <div class="dashboard-card d-none" id="crime">
                <div class="card-header">
                    <h2 class="card-title">Жиноятчилик</h2>
                </div>
                <div class="card-body">
                    <script src="js/data.js"></script>
                    <div id="map" style="height: 100%; border-radius: 12px;"></div>
                    
                    <div class="districts">
                        <h5>Туманлар рўйҳати</h5>
                        <ul class="list-unstyled" id="districts">
                            <li data-district="olmazor">Олмазор тумани</li>
                            <li data-district="shayhontohur">Шайхонтоҳур тумани</li>
                            <li data-district="bektemir">Бектемир тумани</li>
                            <li data-district="chilonzor">Чилонзор тумани</li>
                            <li data-district="mirobod">Миробод тумани</li>
                            <li data-district="mirzo_ulugbek">Мирзо Улуғбек тумани</li>
                            <li data-district="sergeli">Сергели тумани</li>
                            <li data-district="uchtepa">Учтепа тумани</li>
                            <li data-district="yakkasaroy">Яккасарой тумани</li>
                            <li data-district="yangihayot">Янгиҳаёт тумани</li>
                            <li data-district="yashnaobod">Яшнобод тумани</li>
                            <li data-district="yunusobod">Юнусобод тумани</li>
                        </ul>
                    </div>

                    <div class="statistics" style="display: none;">
                        <h5>Туман бўйича динамика</h5>
                        <div class="chart-container">
                            <canvas id="birthRegionChart"></canvas>
                            <canvas id="ageGroupChart" class="mt-5"></canvas>
                        </div>
                    </div>
                  <script>
                //     function filterByDistrict(other, districtName) {
                //         return other.filter(item => 
                //             item["Туман"].toLowerCase().includes(districtName.toLowerCase())
                //         );
                //     }
                //     // 1. Filter for "Олмазор тумани"
                //     const olmazorResults = filterByDistrict(other, "Миробод");
                //     // console.log("Миробод туманидаги жиноятлар:", olmazorResults);

                //    // Group data by birth region and count
                //     const regionCounts = olmazorResults.reduce((acc, item) => {
                //         const region = item["Тўғилган вилоят"];
                //         if (region !== undefined){
                //             acc[region] = (acc[region] || 0) + 1;
                //         }
                //         return acc;
                //     }, {});

                //     // Prepare data for Chart.js
                //     const regions = Object.keys(regionCounts);
                //     const counts = Object.values(regionCounts);

                //     // Generate colors dynamically
                //     const borderColors = regions.map((_, i) => {
                //         const hue = (i * 360 / regions.length) % 360;
                //         return `hsl(${hue}, 70%, 50%)`;
                //     });

                //     // Create line chart
                //     const ctx = document.getElementById('birthRegionChart').getContext('2d');
                //     new Chart(ctx, {
                //         type: 'line',
                //         data: {
                //             labels: regions,
                //             datasets: [{
                //                 // label: 'Тўғилган вилоят буйича динамика',
                //                 data: counts,
                //                 backgroundColor: 'rgba(54, 162, 235, 0.2)',
                //                 borderColor: borderColors,
                //                 borderWidth: 3,
                //                 pointBackgroundColor: borderColors,
                //                 pointRadius: 5,
                //                 pointHoverRadius: 7,
                //                 tension: 0.3,
                //                 fill: true
                //             }]
                //         },
                //         options: {
                //             responsive: true,
                //             plugins: {
                //                 legend: {
                //                     display: false,
                //                     position: 'top',
                //                 },
                //                 title: {
                //                     display: true,
                //                     text: 'Вилоят буйича динамика',
                //                     font: {
                //                         size: 18
                //                     },
                //                     color: 'white'
                //                 },
                //                 tooltip: {
                //                     callbacks: {
                //                         label: function(context) {
                //                             return `${context.parsed.y} нафар`;
                //                         }
                //                     }
                //                 }
                //             },
                //             scales: {
                //                 y: {
                //                     beginAtZero: true,
                //                     title: {
                //                         display: true,
                //                         // text: 'Сон'
                //                     },
                //                     ticks: {
                //                         color: 'white',
                //                         stepSize: 1
                //                     }
                //                 },
                //                 x: {
                //                     ticks: {
                //                         color: 'white'
                //                     }
                //                 }
                //             },
                //             animation: {
                //                 duration: 2000
                //             }
                //         }
                //     });
                    
                //     // Group data by age category
                //     const ageGroups = {};
                //     olmazorResults.forEach(item => {
                //         const ageGroup = item[" Ёш тоифаси"];
                //         if (!ageGroups[ageGroup]) {
                //             ageGroups[ageGroup] = 0;
                //         }
                //         ageGroups[ageGroup]++;
                //     });

                //     // Sort age groups logically
                //     const sortedAgeGroups = {
                //         "15-17 ёш": ageGroups["15-17 ёш"] || 0,
                //         "18-30 ёш": ageGroups["18-30 ёш"] || 0,
                //         "31-49 ёш": ageGroups["31-49 ёш"] || 0,
                //         "50-59 ёш": ageGroups["50-59 ёш"] || 0,
                //         "60 ёш ва ундан катта": ageGroups["60 ёш ва ундан катта"] || 0
                //     };

                //     // Prepare chart data
                //     const labels = Object.keys(sortedAgeGroups);
                //     const data1 = Object.values(sortedAgeGroups);

                //     // Create bar chart
                //     const ctx1 = document.getElementById('ageGroupChart').getContext('2d');
                //     new Chart(ctx1, {
                    //     type: 'bar',
                    //     data: {
                    //         labels: labels,
                    //         datasets: [{
                    //             label: 'Сон',
                    //             data: data1,
                    //             backgroundColor: [
                    //                 'rgba(54, 162, 235, 0.7)',
                    //                 'rgba(255, 99, 132, 0.7)',
                    //                 'rgba(75, 192, 192, 0.7)',
                    //                 'rgba(153, 102, 255, 0.7)'
                    //             ],
                    //             borderColor: [
                    //                 'rgba(54, 162, 235, 1)',
                    //                 'rgba(255, 99, 132, 1)',
                    //                 'rgba(75, 192, 192, 1)',
                    //                 'rgba(153, 102, 255, 1)'
                    //             ],
                    //             borderWidth: 1
                    //         }]
                    //     },
                    //     options: {
                    //         responsive: true,
                    //         plugins: {
                    //             legend: {
                    //                 display: false
                    //             },
                    //             title: {
                    //                 display: true,
                    //                 text: 'Ёш гуруҳлари буйича динамика',
                    //                 font: {
                    //                     size: 16
                    //                 },
                    //                 color: 'white'
                    //             },
                    //             tooltip: {
                    //                 callbacks: {
                    //                     label: function(context) {
                    //                         return `${context.parsed.y} нафар`;
                    //                     }
                    //                 }
                    //             }
                    //         },
                    //         scales: {
                    //             y: {
                    //                 beginAtZero: true,
                    //                 title: {
                    //                     display: true,
                    //                     // text: 'Сон'
                    //                 },
                    //                 ticks: {
                    //                     precision: 0,
                    //                     color: 'white'
                    //                 }
                    //             },
                    //             x: {
                    //                 // title: {
                    //                 //     display: true,
                    //                 //     text: 'Ёш тоифаси'
                    //                 // },
                    //                 ticks: {
                    //                     color: 'white'
                    //                 }
                    //             }
                    //         }
                    //     }
                    // });
                    // *****************************************************************
                    
                    ymaps.ready(init);
            
                    function init() {
                        var map = new ymaps.Map("map", {
                            center: [41.311649232954316, 69.24125933467975], // Toshkent markazi
                            zoom: 12,
                            controls: ['zoomControl', 'typeSelector', 'fullscreenControl']
                        });

                        var districts = {
                            mirobod: createDistrictPolygon(
                                [[41.312697240084375, 69.26901837914095],
                                [41.305010925533516, 69.26554798348963],
                                [41.30456583881327, 69.26542369422948],
                                [41.3037736708225, 69.2654388670942],
                                [41.30271363241355, 69.26585612087365],
                                [41.30120407907706, 69.26705949283362],
                                [41.29979939401375, 69.26763689061126],
                                [41.29979400590848, 69.26764529083748],
                                [41.29572292382547, 69.26873131358758],
                                [41.292549490781504, 69.27121869513802],
                                [41.29063219663235, 69.2690114213818],
                                [41.28954890054428, 69.26896038615163],
                                [41.28880112814945, 69.26755691732205],
                                [41.28763151815846, 69.26628103652654],
                                [41.287458950987556, 69.26555378449666],
                                [41.28568531750194, 69.26616620725866],
                                [41.284774514003814, 69.26423962731988],
                                [41.284028411025396, 69.26505928299743],
                                [41.28326449798294, 69.26553722823571],
                                [41.28359514800942, 69.26636414936227],
                                [41.28011183680799, 69.2690497465342],
                                [41.2778484400206, 69.27297951864895],
                                [41.2715310382408, 69.2673579719591],
                                [41.269780530892106, 69.2656055060854],
                                [41.26817253164325, 69.26363303367341],
                                [41.267592608214, 69.2623709863034],
                                [41.26730749529848, 69.26270858254314],
                                [41.26708225521493, 69.26340653431967],
                                [41.26717064065679, 69.26410448609622],
                                [41.2680801484248, 69.26639558876052],
                                [41.2685990468676, 69.26854254922664],
                                [41.27014461830773, 69.27742177950338],
                                [41.271426762356384, 69.2828183837723],
                                [41.27066026397842, 69.2865943949216],
                                [41.2653379293872, 69.29311752733246],
                                [41.26443470228793, 69.29734468852918],
                                [41.263208874098495, 69.29734468852918],
                                [41.26285402477284, 69.30094957759923],
                                [41.261966893094886, 69.30266619128318],
                                [41.264644381092126, 69.30813789740075],
                                [41.260934579197254, 69.31079864902595],
                                [41.257208435570334, 69.30202246127686],
                                [41.252643216631185, 69.30221558030456],
                                [41.25254230092032, 69.30164197718175],
                                [41.24427947371576, 69.30162868776581],
                                [41.24424524801555, 69.31188554484181],
                                [41.2436462953993, 69.3141235424853],
                                [41.24210040185822, 69.31664223814636],
                                [41.237445387156335, 69.32253689631675],
                                [41.23693765101891, 69.32650460064956],
                                [41.23810263427187, 69.33077662047191],
                                [41.27782612941688, 69.30818658868588],
                                [41.279609564746444, 69.30619621470939],
                                [41.2825626730758, 69.30583896809823],
                                [41.291567317704505, 69.29963602484807],
                                [41.29959275853903, 69.29155245665495],
                                [41.30029764872079, 69.2903976612204],
                                [41.302629154276175, 69.28823241978058],
                                [41.30990779540875, 69.28079842375675],
                                [41.31009754426568, 69.27892188117559],
                                [41.31281825127222, 69.2691388820126],
                                [41.30928848664218, 69.26733643764446],
                                [41.305049292993175, 69.26557690861841]],
                                "Mirobod tumani", "~28.58 km²"
                            ),
                            chilonzor: createDistrictPolygon(
                                [[41.22828451770735, 69.17974875085794],
                                [41.229220520389866, 69.17529091969745],
                                [41.22966027564416, 69.17376206063518],
                                [41.23037840171874, 69.17276427893138],
                                [41.23420289541749, 69.16956708572467],
                                [41.2347596068482, 69.1689769997708],
                                [41.23519529079133, 69.16803286210023],
                                [41.23576006189457, 69.16577980664005],
                                [41.23576006190187, 69.16462109230015],
                                [41.23639744057159, 69.16528628010269],
                                [41.23703481302622, 69.16557595866185],
                                [41.23806750459672, 69.16564033167928],
                                [41.238680657480806, 69.16576907770558],
                                [41.23935834608159, 69.16648790968574],
                                [41.2399069460257, 69.16679904592077],
                                [41.24167897167312, 69.16671573743692],
                                [41.24899008459856, 69.16426327554163],
                                [41.25068583341618, 69.1631626110972],
                                [41.251879614132186, 69.16198977198398],
                                [41.25299198107476, 69.16049214665478],
                                [41.259285993460985, 69.15076660334589],
                                [41.26100860229474, 69.14899832283672],
                                [41.26336926275403, 69.1555604137001],
                                [41.26421605234161, 69.15785102008462],
                                [41.26487734708744, 69.15913848058729],
                                [41.266405557434105, 69.16194407116129],
                                [41.26698618735296, 69.16262535225401],
                                [41.268582892985194, 69.16377333769182],
                                [41.26880062254248, 69.16412738926412],
                                [41.26780067339862, 69.16779665116046],
                                [41.26801840556441, 69.16799513461766],
                                [41.26802243763473, 69.16799513461766],
                                [41.269877163594735, 69.17112259030286],
                                [41.268861102869096, 69.17218474501979],
                                [41.270856921478774, 69.17538730262217],
                                [41.27123591852043, 69.17621342295757],
                                [41.271534276360086, 69.17735067968427],
                                [41.27281639313764, 69.18285993697978],
                                [41.274300069175666, 69.18918458581108],
                                [41.27533217175353, 69.19324545027818],
                                [41.2756466372802, 69.1943451560313],
                                [41.276041732816616, 69.19475821619899],
                                [41.27673112848472, 69.1959115660179],
                                [41.27784785343446, 69.19711319580294],
                                [41.278883931291716, 69.19801978240477],
                                [41.2810558313198, 69.19450572003159],
                                [41.29216057085208, 69.19405053411008],
                                [41.30292147162992, 69.19368638532073],
                                [41.30055057822702, 69.20112108902738],
                                [41.30068736289146, 69.21890368710748],
                                [41.3013940790368, 69.2209975424371],
                                [41.30200959976224, 69.22230240880195],
                                [41.30200959976224, 69.22369831235504],
                                [41.29954748200343, 69.23155785627348],
                                [41.31007922301885, 69.24020638970747],
                                [41.31169758669414, 69.24035811883263],
                                [41.31106506209144, 69.25998801375972],
                                [41.310355601502, 69.25962007179056],
                                [41.310147605568474, 69.25893729287873],
                                [41.30928141524495, 69.25843949809008],
                                [41.307576905497726, 69.25691063902781],
                                [41.30429267709042, 69.25371344587128],
                                [41.30334969012798, 69.25353642004823],
                                [41.30286610178761, 69.25285513893301],
                                [41.30224381988155, 69.25212565261283],
                                [41.30225340478353, 69.25147495337013],
                                [41.30165194930966, 69.25099649808733],
                                [41.30117269792767, 69.25013846819478],
                                [41.30079887942156, 69.24912414299523],
                                [41.300103954691224, 69.24828525130633],
                                [41.29725718124607, 69.24207171189504],
                                [41.29507161919173, 69.24166343005372],
                                [41.29488948571497, 69.24056617260513],
                                [41.29383501874932, 69.24011961434118],
                                [41.29297226026907, 69.2388947687236],
                                [41.2917356200291, 69.23769544081469],
                                [41.28966491411592, 69.23800165219569],
                                [41.287038090669725, 69.23676404780944],
                                [41.28636698744881, 69.23507988521395],
                                [41.28534543538795, 69.23500942139523],
                                [41.28511174238037, 69.23523907993098],
                                [41.284898580778375, 69.23517718144356],
                                [41.28441544175085, 69.23486993092249],
                                [41.28381115663907, 69.23493251898623],
                                [41.282041025132926, 69.23469923617769],
                                [41.28137400659504, 69.23464044132363],
                                [41.28111603392923, 69.23452285162216],
                                [41.280158248013485, 69.23288797537246],
                                [41.2801140640968, 69.23203260507847],
                                [41.279464129502486, 69.2310406789988],
                                [41.27924178196721, 69.23007530542091],
                                [41.27848208885381, 69.22939631970048],
                                [41.277877748801, 69.22863388321704],
                                [41.2755201989824, 69.22600328767273],
                                [41.273233835941284, 69.22466428228117],
                                [41.27175136326917, 69.22328355151662],
                                [41.27021753880102, 69.22253249469472],
                                [41.269399294256715, 69.22162591598506],
                                [41.268874700046375, 69.2215045330674],
                                [41.26820469584959, 69.22115935035545],
                                [41.26670215083998, 69.22057519503944],
                                [41.265852499066625, 69.2196079248451],
                                [41.26527940557002, 69.21898204417592],
                                [41.26512543929586, 69.21923618965977],
                                [41.26441547898111, 69.21839030239262],
                                [41.26291854942557, 69.21847375314812],
                                [41.261772305886375, 69.21789718427392],
                                [41.26047206496376, 69.21662266356807],
                                [41.258997857008126, 69.21567435947827],
                                [41.2577317795156, 69.21528365818884],
                                [41.25628032263756, 69.21430880159373],
                                [41.255641557317375, 69.21393706640487],
                                [41.25403606158034, 69.21446432346397],
                                [41.25323564020067, 69.2153870971996],
                                [41.23636562314215, 69.18855516076857],
                                [41.228289206149164, 69.17985260992957],
                                ],
                                "Chilonzor tumani", "29.94 km2"
                            ),
                            shayhontohur: createDistrictPolygon(
                                [[41.32509184676999, 69.23168666639012],
                                [41.34079149731064, 69.20477000385301],
                                [41.34514298030099, 69.20677282204734],
                                [41.348126886211915, 69.19775332297732],
                                [41.3501315682135, 69.18843718382001],
                                [41.35002219089141, 69.1870747718457],
                                [41.34933878237147, 69.17857796760953],
                                [41.3482908753948, 69.17269089553716],
                                [41.34826809462061, 69.16540792047759],
                                [41.338471622919485, 69.16413339970447],
                                [41.334734906017204, 69.16331406501027],
                                [41.33159042936641, 69.1619485071866],
                                [41.33107635113889, 69.16357470564391],
                                [41.33108774453414, 69.16384023077629],
                                [41.33141815212896, 69.16465197903814],
                                [41.33147227045579, 69.1653461376755],
                                [41.33125010020079, 69.1661313334241],
                                [41.33128428028884, 69.16692411566123],
                                [41.33063485553515, 69.16939349945157],
                                [41.330432621067786, 69.16938211980305],
                                [41.33042493748999, 69.16952427670819],
                                [41.328203556178195, 69.16920900909376],
                                [41.32621754860767, 69.19415623538679],
                                [41.32369567490717, 69.1933569371402],
                                [41.3233572690922, 69.19307798741656],
                                [41.302953104338044, 69.19361236363018],
                                [41.30057623107364, 69.20102620645912],
                                [41.30081585938655, 69.21947544252176],
                                [41.301927723233895, 69.22238445064124],
                                [41.301946893134016, 69.22366033139541],
                                [41.29941641758798, 69.23164734513148],
                                [41.30990191534264, 69.2403998874104],
                                [41.3117419750092, 69.24045092264058],
                                [41.311090293210334, 69.25999741672055],
                                [41.312029479700804, 69.26045673379205],
                                [41.312316983103145, 69.26323815421783],
                                [41.31363948224431, 69.26428437643624],
                                [41.31712768465715, 69.26561129260634],
                                [41.318028453838096, 69.26645337390407],
                                [41.3220530152331, 69.26818857208723],
                                [41.322992043773134, 69.26931134715089],
                                [41.32491796820888, 69.26989825253952],
                                [41.32573239670959, 69.2706255045694],
                                [41.326355188106334, 69.27091895714285],
                                [41.326901323407455, 69.2709189572084],
                                [41.32830017527189, 69.27074033390282],
                                [41.32898042799606, 69.27111033932152],
                                [41.33013013481573, 69.27289657252237],
                                [41.33351207129803, 69.27285829609212],
                                [41.33740156021746, 69.27491246419739],
                                [41.344289026113664, 69.26303401419351],
                                [41.33783743684114, 69.2575477269833],
                                [41.33805297909723, 69.25691616600999],
                                [41.32866851047272, 69.2479977594207],
                                [41.33030945127967, 69.24498648014617],
                                [41.330742980087194, 69.24378077278328],
                                [41.33085794857538, 69.24292593259432],
                                [41.33083878717948, 69.24200091901025],
                                [41.33064956806187, 69.24110461272765],
                                [41.33036454075439, 69.24056874277098],
                                [41.329928614220115, 69.2400743389517],
                                [41.329727416365635, 69.23987976709432],
                                [41.32923399997972, 69.23953846899259],
                                [41.32851935622039, 69.23947897821782],
                                [41.328909594188104, 69.23879999252216],
                                [41.32911753025286, 69.23801858998972],
                                [41.329339707785174, 69.23589677958759],
                                [41.32514724568914, 69.23164110223428]],
                                "Shayhontohur tumani", "29.70 km2"
                            ),
                            sergeli: createDistrictPolygon(
                                [[41.204633, 69.220233],
                                [41.239679, 69.194937],
                                [41.240782, 69.194906],
                                [41.249374, 69.208636],
                                [41.252650, 69.214429],
                                [41.256102, 69.221258],
                                [41.262402, 69.234949],
                                [41.263914, 69.243548],
                                [41.263851, 69.248223],
                                [41.265189, 69.255529],
                                [41.267556, 69.262381],
                                [41.271590, 69.282773],
                                [41.271142, 69.285142],
                                [41.270512, 69.286728],
                                [41.265473, 69.293073],
                                [41.264780, 69.294910],
                                [41.264465, 69.297414],
                                [41.263172, 69.297665],
                                [41.263035, 69.300623],
                                [41.262054, 69.302582],
                                [41.264643, 69.307521],
                                [41.264528, 69.308413],
                                [41.260508, 69.311091],
                                [41.256161, 69.300572],
                                [41.255745, 69.300990],
                                [41.254246, 69.300664],
                                [41.252812, 69.301767],
                                [41.244176, 69.301347],
                                [41.244176, 69.311570],
                                [41.243672, 69.313657],
                                [41.242916, 69.315327],
                                [41.238883, 69.320002],
                                [41.237623, 69.322005],
                                [41.237244, 69.317585],
                                [41.232673, 69.312202],
                                [41.231940, 69.308381],
                                [41.231633, 69.308434],
                                [41.230821, 69.307304],
                                [41.227925, 69.299728],
                                [41.225776, 69.296472],
                                [41.225543, 69.296662],
                                [41.224732, 69.295454],
                                [41.223912, 69.294983],
                                [41.223253, 69.294183],
                                [41.222977, 69.292461],
                                [41.221715, 69.289191],
                                [41.220892, 69.289918],
                                [41.218368, 69.289700],
                                [41.215624, 69.287301],
                                [41.213758, 69.284176],
                                [41.211617, 69.283740],
                                [41.209532, 69.282650],
                                [41.208270, 69.281342],
                                [41.206403, 69.279162],
                                [41.205196, 69.280542],
                                [41.200585, 69.272693],
                                [41.196688, 69.263754],
                                [41.192220, 69.257577],
                                [41.191985, 69.256652],
                                [41.191594, 69.256289],
                                [41.195085, 69.250980],
                                [41.197460, 69.248896],
                                [41.200098, 69.247509],
                                [41.206255, 69.246358],
                                [41.215272, 69.245061],
                                [41.205057, 69.220379]],
                                "Sergeli", '67.98'
                            ),
                            mirzo_ulugbek: createDistrictPolygon(
                                [[41.31069161159559, 69.2815565143562],
                                [41.31186080802847, 69.28142892628078],
                                [41.31258914930466, 69.2800892514889],
                                [41.316748205458126, 69.28110995610369],
                                [41.31591449888667, 69.28410827587598],
                                [41.31817602297652, 69.2860476146223],
                                [41.31774480621737, 69.2907683734127],
                                [41.31819518814007, 69.2915721785741],
                                [41.318923458641166, 69.2909597558121],
                                [41.32267009015646, 69.29166149025423],
                                [41.32251677954123, 69.2931542707366],
                                [41.32329291082194, 69.29293737100839],
                                [41.32564041217471, 69.29439187513363],
                                [41.32520209651536, 69.29639848895923],
                                [41.32612351243358, 69.2978698228398],
                                [41.327735958889605, 69.29817656537709],
                                [41.32849474341435, 69.29747286190917],
                                [41.32861669014749, 69.29655263428826],
                                [41.32946353585603, 69.29644437221627],
                                [41.330418764604275, 69.29777058259815],
                                [41.32992421529872, 69.29860961365608],
                                [41.329951449410906, 69.29917494125142],
                                [41.33019356281126, 69.2994404663838],
                                [41.330737602611265, 69.3006770550103],
                                [41.33099395485492, 69.3007756786309],
                                [41.3308116600297, 69.3018226062957],
                                [41.33164907267245, 69.30208054499573],
                                [41.33340931317715, 69.3014963897321],
                                [41.33369983372864, 69.3033323063617],
                                [41.33617205428449, 69.30250538521693],
                                [41.33619115203103, 69.30267777940189],
                                [41.33618687984278, 69.30311779247842],
                                [41.33628798822319, 69.30342883620493],
                                [41.33624241827126, 69.30382143414245],
                                [41.33609573976259, 69.30447955714914],
                                [41.33616551890012, 69.30493094987418],
                                [41.336994318464996, 69.30604994873896],
                                [41.33837451317113, 69.30550452051075],
                                [41.338650771489824, 69.30559176448281],
                                [41.33919302168786, 69.30742411654654],
                                [41.3390406538225, 69.30782619746128],
                                [41.33924855755519, 69.30907985546928],
                                [41.339195869686975, 69.30944400422226],
                                [41.338515128593244, 69.31008795579463],
                                [41.33442979734972, 69.31206518570852],
                                [41.3320359834367, 69.31353026386687],
                                [41.33335808245898, 69.31640737496751],
                                [41.335278910438056, 69.31711548893556],
                                [41.33614589903884, 69.3166178954427],
                                [41.33651951486554, 69.31585874639399],
                                [41.33800916693758, 69.31562908784835],
                                [41.33887611920323, 69.3158077111822],
                                [41.33930719612731, 69.31657961903846],
                                [41.33943172892973, 69.31695600386094],
                                [41.340322610521284, 69.31722393885046],
                                [41.340935683228906, 69.31860826946873],
                                [41.34245876079158, 69.31902293077272],
                                [41.34325381226869, 69.31896551613877],
                                [41.34549523049062, 69.32153003650964],
                                [41.34719061097777, 69.32245505014168],
                                [41.347497115724124, 69.32336730488092],
                                [41.34979585536818, 69.3257085461596],
                                [41.35049982817376, 69.32583613429546],
                                [41.35125647069064, 69.32560009635594],
                                [41.351213371048686, 69.329510671059],
                                [41.35110801622727, 69.33315969021753],
                                [41.35086857279792, 69.33359348967394],
                                [41.35274578567063, 69.3358326603975],
                                [41.355633331481364, 69.34217378803383],
                                [41.355982893037556, 69.34376225982058],
                                [41.35627020247341, 69.34330294274908],
                                [41.35650483757194, 69.34457244409947],
                                [41.3562318946219, 69.34652454165335],
                                [41.355551926503686, 69.34902526817805],
                                [41.3549980330713, 69.3512265913736],
                                [41.35493790491392, 69.35270784445154],
                                [41.35568013028935, 69.3564397958582],
                                [41.35885963223576, 69.35966139485947],
                                [41.3620964355049, 69.36237902096768],
                                [41.36252257071522, 69.36439491277144],
                                [41.362264017120054, 69.36748892360028],
                                [41.36136385955261, 69.37482523842563],
                                [41.36150271445763, 69.37657319505882],
                                [41.36354241101375, 69.38312484305597],
                                [41.366496506080026, 69.39264929352706],
                                [41.366424690125996, 69.39462052929223],
                                [41.36619966629006, 69.3951755374203],
                                [41.3654240462533, 69.39601761871805],
                                [41.36479205267595, 69.3963812449505],
                                [41.36303488688442, 69.39650883302592],
                                [41.35901726414031, 69.39527867603735],
                                [41.35808057735257, 69.39508751043591],
                                [41.35700146541688, 69.39533427365299],
                                [41.35662296669383, 69.39557030803454],
                                [41.35938515147467, 69.40175011729674],
                                [41.36210695657048, 69.4065673649838],
                                [41.35421532870643, 69.41082860028285],
                                [41.35110006629772, 69.41155034772821],
                                [41.34860774916236, 69.41165860980018],
                                [41.343622828661324, 69.40906032007243],
                                [41.34045287094175, 69.40371939118756],
                                [41.33833947975339, 69.39881150969111],
                                [41.33730985422927, 69.39491407509946],
                                [41.33725566296131, 69.39332623137693],
                                [41.33861043113342, 69.38650572084154],
                                [41.338347183261725, 69.38454102194954],
                                [41.33773200563038, 69.38184025203161],
                                [41.337048468094956, 69.37944293909094],
                                [41.33553326769311, 69.37892706169089],
                                [41.33323191846028, 69.3775463310025],
                                [41.33012154988713, 69.37463314079105],
                                [41.32362689500988, 69.36554459419354],
                                [41.3155475526057, 69.35414977261372],
                                [41.309689687860406, 69.34378670540504],
                                [41.30638443469547, 69.33940174731701],
                                [41.31147901363033, 69.33330225532171],
                                [41.31302896311658, 69.33117805426267],
                                [41.3146814422657, 69.32881108717389],
                                [41.31552476029023, 69.32187708779001],
                                [41.31595781127151, 69.31899424318081],
                                [41.31704042606802, 69.31646037477465],
                                [41.31884094563384, 69.31158988490552],
                                [41.31373554561475, 69.30857048473041],
                                [41.31193488495073, 69.30725044528376],
                                [41.312550306177855, 69.30564212162476],
                                [41.312145118594366, 69.30486772958456],
                                [41.31194852510965, 69.30407115412554],
                                [41.311860200308615, 69.30328595837693],
                                [41.31209383339617, 69.30270559620641],
                                [41.31233601314852, 69.30247421001962],
                                [41.31250126469845, 69.30238317283138],
                                [41.31238159982483, 69.30182936326956],
                                [41.311800367314106, 69.3014765941651],
                                [41.31217930870867, 69.30033483603003],
                                [41.31208813504129, 69.30006551768147],
                                [41.31094845342683, 69.2992613557966],
                                [41.31053816316438, 69.29856340394123],
                                [41.31049827369641, 69.29750888984405],
                                [41.310059487938034, 69.29758854738378],
                                [41.30931582478701, 69.29816890947703],
                                [41.308070668657884, 69.29825236022538],
                                [41.30744380761568, 69.29853685143866],
                                [41.306979356663604, 69.29492950264247],
                                [41.30752928900856, 69.29249425776864],
                                [41.30929984970587, 69.28626074477968],
                                [41.31069161159559, 69.2815565143562]],
                                "Mirzo Ulug'bek", '65.4'
                            ),
                            uchtepa: createDistrictPolygon(
                                [[41.27888892501892, 69.19795606916466],
                                [41.27670573558686, 69.19580887140351],
                                [41.275580211801106, 69.19400450334265],
                                [41.27147298981111, 69.1772291015771],
                                [41.27109326680047, 69.1758397383199],
                                [41.26880132030526, 69.17215882787221],
                                [41.26985915176257, 69.17104011979498],
                                [41.267811282957304, 69.16764790778305],
                                [41.26882844432993, 69.16412939044335],
                                [41.26855889810941, 69.16379332692821],
                                [41.26698228469492, 69.16257988945297],
                                [41.26639909759671, 69.16191678417766],
                                [41.2654497121525, 69.16024774390115],
                                [41.26517845660256, 69.15961621498319],
                                [41.26446979624079, 69.15833962471764],
                                [41.26410359551494, 69.15756825737778],
                                [41.26303888917341, 69.15464969223247],
                                [41.26139771545558, 69.14986360629284],
                                [41.261038279347595, 69.14898397695792],
                                [41.26186904848604, 69.14832087176698],
                                [41.26368653108423, 69.14745026425538],
                                [41.265402242510156, 69.14710743432603],
                                [41.27753978236263, 69.14653454752664],
                                [41.281011110693996, 69.1476893429828],
                                [41.281280605500285, 69.14658642312443],
                                [41.28035177592602, 69.14469183681071],
                                [41.27855419980009, 69.1430137998028],
                                [41.277738910460634, 69.14103374095848],
                                [41.27593155439706, 69.14047234494538],
                                [41.27265880123514, 69.13619359685238],
                                [41.27167808365805, 69.13416801927247],
                                [41.27079428487334, 69.13347765392827],
                                [41.26892401311093, 69.13129276127913],
                                [41.267715150412805, 69.1267788339095],
                                [41.26692823718296, 69.12529947929913],
                                [41.26732169496536, 69.12369115564013],
                                [41.266933939486606, 69.1228263023518],
                                [41.2664150278167, 69.1225152586253],
                                [41.26614701687769, 69.12217386916939],
                                [41.26614131450532, 69.12190075760465],
                                [41.26642643251309, 69.12180972041641],
                                [41.26808009240705, 69.12279595662238],
                                [41.26855907577347, 69.12284147522334],
                                [41.269927580180294, 69.12273526517039],
                                [41.27005872701308, 69.1233573526234],
                                [41.27003021685444, 69.12510981849711],
                                [41.27054339780494, 69.12557259087069],
                                [41.27138728661049, 69.12561052304612],
                                [41.27194607186643, 69.12551948586433],
                                [41.27216844424772, 69.12562569591728],
                                [41.273006610261255, 69.12679400649975],
                                [41.27355397821415, 69.12721884680009],
                                [41.27418686664374, 69.12814439154725],
                                [41.27471711979303, 69.12832646592373],
                                [41.27517894967164, 69.12822784230315],
                                [41.275817523918704, 69.12842508954998],
                                [41.27626794303655, 69.12891820765297],
                                [41.27711745924253, 69.13031411120606],
                                [41.27833755045925, 69.13092102586131],
                                [41.278998898763284, 69.13150518115255],
                                [41.27910722241577, 69.13225623795557],
                                [41.27885636736771, 69.1328403932468],
                                [41.278941886242414, 69.13325764702624],
                                [41.27915853360253, 69.13323488784008],
                                [41.28026456394746, 69.13281004762827],
                                [41.28063513693277, 69.13295418984298],
                                [41.281153935577215, 69.13397835821074],
                                [41.281866564383826, 69.13418319190434],
                                [41.28273311049244, 69.13419836476905],
                                [41.28402150650094, 69.13485838445307],
                                [41.28754451251774, 69.13186174362222],
                                [41.28805755577499, 69.13202864513401],
                                [41.28876440876583, 69.13330316576943],
                                [41.28875585817056, 69.13382283638566],
                                [41.28887841659555, 69.13401629041068],
                                [41.28905512836078, 69.13403525653578],
                                [41.289659364895805, 69.13366731456662],
                                [41.28987882678023, 69.13378869748429],
                                [41.28992442915708, 69.13418319196668],
                                [41.29009543780464, 69.134630791547],
                                [41.29032629874318, 69.13487735059849],
                                [41.290668313446815, 69.13496838778674],
                                [41.29087922162033, 69.13526805186471],
                                [41.290970424959404, 69.13606462733262],
                                [41.29192235205371, 69.13707362287562],
                                [41.29252656203374, 69.13816227591839],
                                [41.29396866326633, 69.1386478076297],
                                [41.29437905779659, 69.138370902859],
                                [41.294815099139534, 69.13834435034576],
                                [41.29510579176184, 69.13864022123504],
                                [41.29536228416486, 69.13949369487483],
                                [41.29584676707828, 69.13979335898213],
                                [41.29597786183218, 69.14013474843804],
                                [41.296126055584544, 69.1400930230601],
                                [41.29659343368717, 69.14017268061207],
                                [41.29679292331575, 69.14099960173863],
                                [41.29847716146145, 69.14208446165715],
                                [41.29885903006921, 69.14276344740611],
                                [41.29931498962818, 69.14294172856641],
                                [41.2997282002251, 69.14274827454139],
                                [41.29993907912206, 69.14288103714043],
                                [41.30020125191627, 69.14333242986547],
                                [41.30022119980314, 69.14397727661553],
                                [41.300756940767556, 69.14482316382298],
                                [41.30105900556739, 69.1448724756898],
                                [41.30175716879425, 69.144641089503],
                                [41.302042131240505, 69.14477385209118],
                                [41.3027801781678, 69.14534283454961],
                                [41.30310218057592, 69.14596112878645],
                                [41.303372889355735, 69.1460976846072],
                                [41.30379177332569, 69.14663252808813],
                                [41.30401118766467, 69.14757324569999],
                                [41.30446996073755, 69.14797911990625],
                                [41.30545303497675, 69.1485784480622],
                                [41.305806368207094, 69.14873017674795],
                                [41.30691194685733, 69.1486353463533],
                                [41.307176941013054, 69.14885535289157],
                                [41.30758155368679, 69.14880604111057],
                                [41.308102987419154, 69.14907156624297],
                                [41.30839362082183, 69.14900708158537],
                                [41.30949840865891, 69.14839749452838],
                                [41.30997759883083, 69.1483719769133],
                                [41.3099392637467, 69.14754265442308],
                                [41.310174065804176, 69.14723644299342],
                                [41.31061012448571, 69.14718540776326],
                                [41.31121389322977, 69.14747248093293],
                                [41.31145348245151, 69.14775317469885],
                                [41.31170265430807, 69.14773403648753],
                                [41.31190869954698, 69.14735765166506],
                                [41.31223932895391, 69.1473257546322],
                                [41.31329829000153, 69.14680902292676],
                                [41.313614537476354, 69.14649643214199],
                                [41.313825368273896, 69.14672609067775],
                                [41.31374870260825, 69.14698764623235],
                                [41.313240790295815, 69.14720454596056],
                                [41.313221623716, 69.14742144568875],
                                [41.31332224819729, 69.14752351614909],
                                [41.31355224642841, 69.1474533427076],
                                [41.31371516135115, 69.14728747820958],
                                [41.31387807590881, 69.14735127224792],
                                [41.313973907786625, 69.1476383454176],
                                [41.313815785112695, 69.14803386845139],
                                [41.31412723849805, 69.1482316299683],
                                [41.31472618313352, 69.14833370042862],
                                [41.31535866269438, 69.1490609524585],
                                [41.31547365831883, 69.14950113131869],
                                [41.3160438419886, 69.14969251346115],
                                [41.3190000923608, 69.1516956463336],
                                [41.32005415246926, 69.1521358252558],
                                [41.321616046526835, 69.15418361392854],
                                [41.322459262123076, 69.1545727575875],
                                [41.32278983797936, 69.15443241070453],
                                [41.323345584939474, 69.15355205296382],
                                [41.32372406505323, 69.15357119117512],
                                [41.32476367633203, 69.15387740255613],
                                [41.32517568362072, 69.15360308818856],
                                [41.32534336024571, 69.15362860580365],
                                [41.32597094606947, 69.15466206921451],
                                [41.32658894455265, 69.15443879012066],
                                [41.32743209578007, 69.155153283343],
                                [41.32726921514322, 69.15671623726685],
                                [41.32823691180383, 69.15784539183261],
                                [41.32839020896117, 69.15875126716806],
                                [41.329333936640815, 69.15934455171875],
                                [41.330612977247085, 69.15901920214169],
                                [41.33069441343677, 69.1598038688055],
                                [41.33150397946588, 69.16132854645974],
                                [41.33152793096936, 69.16210683371979],
                                [41.33105847989591, 69.16357409658707],
                                [41.331422544288166, 69.16466497463189],
                                [41.331484818258424, 69.16535395050981],
                                [41.33125009298922, 69.16613223776986],
                                [41.331283625222326, 69.16692328383743],
                                [41.330651300206625, 69.16940487190428],
                                [41.33043094307728, 69.1693793542892],
                                [41.33042604267065, 69.16952596686671],
                                [41.328190089379056, 69.16926750678827],
                                [41.3265133768966, 69.19414718159942],
                                [41.323485604043604, 69.19307544176593],
                                [41.281388792119145, 69.19459544858917],
                                [41.280679278512565, 69.19492717758526],
                                [41.27888892501892, 69.19795606916466]],
                                "Uchtepa", '8.7'
                            ),
                            bektemir: createDistrictPolygon(
                                [[41.20385830031346, 69.27293524044597],
                                [41.20979579704981, 69.26551218749333],
                                [41.21100338509006, 69.26951477569209],
                                [41.21190524631089, 69.26954946532514],
                                [41.21361427255862, 69.27131704104205],
                                [41.214334028557204, 69.2723499229229],
                                [41.21522986416871, 69.27486701615966],
                                [41.21519932452109, 69.27824795044953],
                                [41.21547078757464, 69.27818930854926],
                                [41.21707918295864, 69.27911404711716],
                                [41.2180581130987, 69.27965986839676],
                                [41.218702807830496, 69.27909149255342],
                                [41.22071150001395, 69.28389111107833],
                                [41.22138331241506, 69.28500981945422],
                                [41.22213654834124, 69.28592553614645],
                                [41.22335460071525, 69.28759006558387],
                                [41.22449459575391, 69.28942601003178],
                                [41.225454754735395, 69.2911266268328],
                                [41.226604891277006, 69.29330089019746],
                                [41.2272834284057, 69.29454139310569],
                                [41.22797892167622, 69.29604352950393],
                                [41.22832157660559, 69.29656228526555],
                                [41.22894242205159, 69.29856513359738],
                                [41.22934274552281, 69.29924628259094],
                                [41.22962772004136, 69.29976503835256],
                                [41.22999411402574, 69.30117244528844],
                                [41.23061155111057, 69.30248512309593],
                                [41.23135111092612, 69.30407296686822],
                                [41.231422352483705, 69.30468194102316],
                                [41.23158179760141, 69.30742006938345],
                                [41.23209405480408, 69.30890867301412],
                                [41.23243668816648, 69.31104233801628],
                                [41.23252828293823, 69.31161973592292],
                                [41.23284716737373, 69.3122783301942],
                                [41.23391915047904, 69.31359551880512],
                                [41.23725371967809, 69.31762377023557],
                                [41.23768791353509, 69.3219768078935],
                                [41.237175700173474, 69.32379470863998],
                                [41.2369518175793, 69.32570733857847],
                                [41.23744367985414, 69.32869807852101],
                                [41.23931611477777, 69.33371422138981],
                                [41.243868078893996, 69.33860405865687],
                                [41.24549612618062, 69.34387281310381],
                                [41.24749721207913, 69.34982271643304],
                                [41.25212321670353, 69.35604327496102],
                                [41.26733517106171, 69.36669806788608],
                                [41.26766066679849, 69.36805134378595],
                                [41.26763354221575, 69.36956701279382],
                                [41.26845405585893, 69.37111876915901],
                                [41.268555771762145, 69.37265248214644],
                                [41.27269886271168, 69.37751525370231],
                                [41.27391936308208, 69.37952712387347],
                                [41.27356677643007, 69.38029398021673],
                                [41.27311524851394, 69.38251989298841],
                                [41.270446768647226, 69.3827019673649],
                                [41.267504472038894, 69.38696554288249],
                                [41.26756149454959, 69.3916691309418],
                                [41.26606628961502, 69.39650492467801],
                                [41.26519952223029, 69.39796151968991],
                                [41.263762487795404, 69.39708149353689],
                                [41.26068302172821, 69.39388001901177],
                                [41.255470409431894, 69.38567149897354],
                                [41.25405597457623, 69.38448801543093],
                                [41.24823821894835, 69.39181650943873],
                                [41.247017565280885, 69.39254480694468],
                                [41.245876746845724, 69.39318206726239],
                                [41.24477013382816, 69.393364141679],
                                [41.2436863195116, 69.39322758589664],
                                [41.24253403405, 69.3925296341201],
                                [41.240389131756096, 69.38925229534328],
                                [41.2351749000936, 69.38095273799273],
                                [41.240982409552366, 69.37954166157495],
                                [41.242305856263755, 69.38016374889773],
                                [41.242465580771686, 69.37926854988],
                                [41.24295616074797, 69.37860094383288],
                                [41.24270516680158, 69.37720504027979],
                                [41.24167836331382, 69.37274421756338],
                                [41.23977302971569, 69.37124210395734],
                                [41.239750211012684, 69.3712120754924],
                                [41.24059449771947, 69.3699830734511],
                                [41.23909987459025, 69.36559811506194],
                                [41.23938511064404, 69.36154696018505],
                                [41.23813006269648, 69.35987794506723],
                                [41.230005896710395, 69.3484376045642],
                                [41.228051724300705, 69.35036455828897],
                                [41.22674913162038, 69.3501093843236],
                                [41.22601593074343, 69.34888417549847],
                                [41.225539488390226, 69.34714688233669],
                                [41.22503736576939, 69.34696860117639],
                                [41.22457518128739, 69.34659686593],
                                [41.22368503905581, 69.34571683977695],
                                [41.223442530234244, 69.34521613516033],
                                [41.22131561387343, 69.34018982648499],
                                [41.22058235206104, 69.33872943818224],
                                [41.219614003004764, 69.33846665923642],
                                [41.21901767793384, 69.33803802580843],
                                [41.21845558664523, 69.33804940545696],
                                [41.21781498712944, 69.33658405079929],
                                [41.21735845825975, 69.3353702216227],
                                [41.21711592598572, 69.33538160121753],
                                [41.21713019261404, 69.33462295798216],
                                [41.220330635547235, 69.33433331699436],
                                [41.21893038036111, 69.33123610329365],
                                [41.21822909054459, 69.32806999765248],
                                [41.217179944775935, 69.32616026484298],
                                [41.21392956235242, 69.32159250348342],
                                [41.21289512400833, 69.31867023181623],
                                [41.21356500904136, 69.3182196207242],
                                [41.21436805494984, 69.31949098773386],
                                [41.216095175605886, 69.31769390772808],
                                [41.21503792494354, 69.3159397431198],
                                [41.21442455028895, 69.31543012332992],
                                [41.21328252825559, 69.31445379929717],
                                [41.21318567741342, 69.3142070360801],
                                [41.21395644472887, 69.31371350964596],
                                [41.212707805590604, 69.30994062919693],
                                [41.21258674095189, 69.30729060682233],
                                [41.21272798300859, 69.30711358103618],
                                [41.214168634568516, 69.30826693085508],
                                [41.2143340855387, 69.30785923509849],
                                [41.21213195266357, 69.30151323781435],
                                [41.20804611012339, 69.2949288773199],
                                [41.20827733087632, 69.29226900162172],
                                [41.20385830031346, 69.27293524044597]],
                                'Bektemir', '34.5'
                            ),
                            olmazor: createDistrictPolygon(
                                [[41.348323, 69.165066],
                                [41.351631, 69.166164],
                                [41.354775, 69.167701],
                                [41.357807, 69.169823],
                                // [41.354343, 69.223349],
                                [41.361005, 69.174214],
                                [41.372252, 69.191631],
                                [41.372252, 69.191631],
                                [41.385027, 69.211057],
                                [41.386901, 69.210590],
                                [41.387095, 69.211641],
                                [41.386879, 69.212606],
                                [41.387184, 69.215233],
                                [41.395102, 69.228068],
                                [41.386023, 69.236073],
                                [41.384561, 69.237127],
                                [41.381683, 69.237948],
                                [41.379467, 69.239966],
                                [41.374591, 69.247111],
                                [41.369779, 69.252155],
                                [41.365789, 69.258124],
                                [41.363370, 69.261577],
                                [41.355674, 69.269560],
                                [41.349448, 69.262877],
                                [41.347507, 69.266138],
                                [41.346278, 69.264422],
                                [41.345340, 69.264035],
                                [41.343917, 69.262834],
                                [41.340424, 69.260473],
                                [41.339195, 69.259057],
                                [41.337873, 69.256884],
                                [41.326767, 69.246148],
                                [41.327495, 69.244947],
                                [41.327107, 69.244088],
                                [41.326896, 69.243960],
                                [41.326654, 69.243209],
                                [41.327430, 69.242801],
                                [41.326605, 69.240741],
                                [41.328433, 69.239604],
                                [41.329031, 69.238724],
                                [41.329323, 69.235977],
                                [41.325211, 69.231685],
                                [41.340320, 69.205035],
                                [41.341517, 69.204928],
                                [41.345075, 69.207074],
                                [41.347791, 69.198748],
                                [41.349149, 69.193255],
                                [41.350055, 69.188148],
                                [41.349440, 69.182140],
                                [41.349279, 69.178364],
                                [41.348212, 69.173128],
                                [41.348305, 69.165060]],
                                "Olmazor", '34.5'
                            ),
                            yangihayot: createDistrictPolygon(
                                [[41.218322, 69.172790],
                                [41.222729, 69.174507],
                                [41.236013, 69.187467],
                                [41.240807, 69.195020],
                                [41.239641, 69.195106],
                                [41.205035, 69.220169],
                                [41.215471, 69.245145],
                                [41.199136, 69.247892],
                                [41.195830, 69.250295],
                                [41.191810, 69.256046],
                                [41.196997, 69.264114],
                                [41.200627, 69.272525],
                                [41.205359, 69.280422],
                                [41.204517, 69.281366],
                                [41.205165, 69.286172],
                                [41.205748, 69.288146],
                                [41.202377, 69.296901],
                                [41.194479, 69.304540],
                                [41.187347, 69.313466],
                                [41.179242, 69.302738],
                                [41.166466, 69.282739],
                                [41.164844, 69.279392],
                                [41.163936, 69.275186],
                                [41.163677, 69.268920],
                                [41.164390, 69.262912],
                                [41.164779, 69.257677],
                                [41.166012, 69.246776],
                                [41.166076, 69.237077],
                                [41.167114, 69.230812],
                                [41.171038, 69.219782],
                                [41.174638, 69.208238],
                                [41.175989, 69.205234],
                                [41.178388, 69.202058],
                                [41.194468, 69.187896],
                                [41.195637, 69.186611],
                                [41.197386, 69.185407],
                                [41.200692, 69.184720],
                                [41.204841, 69.185493],
                                [41.205943, 69.182532],
                                [41.206737, 69.182081],
                                [41.207336, 69.183412],
                                [41.208244, 69.182939],
                                [41.209216, 69.184463],
                                [41.211421, 69.185057],
                                [41.214662, 69.181623],
                                [41.216671, 69.183726],
                                [41.218889, 69.180665],
                                [41.218193, 69.179871],
                                [41.218954, 69.178326],
                                [41.218679, 69.178176],
                                [41.219359, 69.177425],
                                [41.219805, 69.176121],
                                [41.219382, 69.175757],
                                [41.219173, 69.174689],
                                [41.219505, 69.174850],
                                [41.219667, 69.174120],
                                // [41.190923, 69.230060],
                                [41.218841, 69.173326],
                                [41.218450, 69.172674]],
                                "Yangihayot", '32.1'
                            ),                    
                            yashnaobod: createDistrictPolygon(
                                [[41.237998, 69.330886],
                                [41.242079, 69.328225],
                                [41.277410, 69.308570],
                                [41.279546, 69.305995],
                                [41.282460, 69.305716],
                                [41.287186, 69.302884],
                                [41.296864, 69.294665],
                                [41.296799, 69.292090],
                                [41.299388, 69.291575],
                                [41.300634, 69.289901],
                                [41.310067, 69.280675],
                                [41.310666, 69.281554],
                                [41.307090, 69.294579],
                                [41.307479, 69.298527],
                                [41.307998, 69.298268],
                                [41.310835, 69.297661],
                                [41.312246, 69.300189],
                                [41.312715, 69.302548],
                                [41.312040, 69.303544],
                                [41.312646, 69.305520],
                                [41.315628, 69.305060],
                                [41.314519, 69.307820],
                                [41.313131, 69.307544],
                                [41.312715, 69.308372],
                                [41.317250, 69.311404],
                                [41.318634, 69.311910],
                                [41.316049, 69.319681],
                                [41.315093, 69.328346],
                                [41.309835, 69.335743],
                                [41.307445, 69.338279],
                                [41.307126, 69.339970],
                                [41.306819, 69.342496],
                                [41.307428, 69.350339],
                                [41.308559, 69.357029],
                                [41.316385, 69.377329],
                                [41.318529, 69.382652],
                                [41.320308, 69.387634],
                                [41.322417, 69.401621],
                                [41.326173, 69.423649],
                                [41.325855, 69.433475],
                                [41.320915, 69.449231],
                                [41.315133, 69.437379],
                                [41.313136, 69.435288],
                                [41.311349, 69.434312],
                                [41.311033, 69.431105],
                                [41.309877, 69.429292],
                                [41.308510, 69.428456],
                                [41.306828, 69.425109],
                                [41.299783, 69.417998],
                                [41.299783, 69.417998],
                                [41.275489, 69.389693],
                                [41.274437, 69.386905],
                                [41.272754, 69.384813],
                                [41.271282, 69.384395],
                                [41.270019, 69.383280],
                                [41.269914, 69.380073],
                                [41.265916, 69.378399],
                                [41.262971, 69.376029],
                                [41.262024, 69.374635],
                                [41.267179, 69.368221],
                                [41.266863, 69.366269],
                                [41.252765, 69.356509],
                                [41.250660, 69.354696],
                                [41.246661, 69.347167],
                                [41.243925, 69.338801],
                                [41.239505, 69.334060],
                                [41.239505, 69.334060]],
                                "Yashnaobod", '7.6'
                            )
                        }

                        for (var key in districts) {
                            if (districts.hasOwnProperty(key)) {
                                map.geoObjects.add(districts[key].polygon);
                            }
                        }

                        // Ro'yxat elementlariga hodisa qo'shish
                        document.querySelectorAll('#districts li').forEach(function(item) {
                            item.addEventListener('click', function() {
                                // Faol elementni belgilash
                                document.querySelectorAll('#districts li').forEach(function(li) {
                                    li.classList.remove('active');
                                });
                                this.classList.add('active');
                                
                                // Tegishli tuman poligonini topish
                                var districtId = this.getAttribute('data-district');
                                var district = districts[districtId];
                                
                                if (district) {
                                    // Xaritani poligon markaziga va kattalashtirish
                                    map.setBounds(district.polygon.geometry.getBounds(), {
                                        checkZoomRange: true
                                    });
                                    
                                    // Poligon stilini o'zgartirish (tanlanganini ajratib ko'rsatish)
                                    for (var key in districts) {
                                        if (districts.hasOwnProperty(key)) {
                                            districts[key].polygon.options.set({
                                                fillColor: '#000080',
                                                fillOpacity: 0.2
                                            });
                                        }
                                    }
                                    district.polygon.options.set({
                                        fillColor: '#FF0000',
                                        fillOpacity: 0.5
                                    });
                                    
                                    // Balloon ochish
                                    district.polygon.balloon.open();
                                }
                            });
                        });
                        
                        // Poligon yaratish uchun yordamchi funksiya
                        function createDistrictPolygon(coordinates, name, area) {
                            var polygon = new ymaps.Polygon([coordinates], {
                                balloonContent: `
                                    <div style="padding: 5px;">
                                        <b>${name}</b><br>
                                        <small>Hudud: ${area}</small>                                        
                                    </div>
                                `,
                                hintContent: name
                            }, {
                                fillColor: '#000080',
                                strokeColor: '#800000',
                                strokeWidth: 3,
                                fillOpacity: 0.2
                            });

                             polygon.events.add('click', () => {
                                const bounds = polygon.geometry.getBounds();
                                const center = [
                                    (bounds[0][0] + bounds[1][0]) / 2,
                                    (bounds[0][1] + bounds[1][1]) / 2
                                ];

                                mapInstance.setBounds(bounds, { checkZoomRange: true, duration: 300 });
                                mapInstance.setCenter(center, mapInstance.getZoom(), { duration: 300 });

                                // filterByDistrict(name);
                            });
                            
                            return {
                                polygon: polygon,
                                name: name,
                                area: area
                            };
                        }

                        var polygonCoordinates = [
                            [41.235785707706064, 69.16466935839502],
                            [41.23648484378027, 69.16532598148007],
                            [41.23699258341695, 69.16554598801811],
                            [41.23802801774724, 69.16559150660542],
                            [41.23843591161046, 69.16565978449661],
                            [41.238886588603805, 69.16596703503888],
                            [41.239348671893545, 69.16647532600658],
                            [41.239819308943005, 69.16672188507223],
                            [41.24018725916911, 69.16680154261195],
                            [41.24070923151752, 69.16673326472076],
                            [41.24113707462253, 69.16673326472073],
                            [41.24162481231518, 69.16666119361336],
                            [41.24542069297069, 69.16537129416822],
                            [41.249445967780495, 69.16398727428711],
                            [41.25102696977063, 69.1629358484057],
                            [41.25236595181777, 69.1614874555194],
                            [41.253946883145396, 69.15893399266454],
                            [41.25695538661568, 69.1540201857498],
                            [41.259721797016105, 69.15026509309581],
                            [41.26110899080131, 69.14873086942322],
                            [41.26350425014009, 69.14747559566683],
                            [41.2649155571902, 69.14706789984737],
                            [41.26818967187177, 69.14696061149212],
                            [41.273769804333014, 69.14660655990804],
                            [41.27768851401504, 69.1465421868847],
                            [41.28348551507881, 69.14848410622487],
                            [41.28694412027792, 69.14935314200771],
                            [41.292248571033014, 69.1500397875503],
                            [41.29844729902818, 69.1507693484179],
                            [41.30354126129522, 69.15135943439154],
                            [41.304597080292, 69.15069424653284],
                            [41.307079396433416, 69.1510268404341],
                            [41.30852199786677, 69.15206753759772],
                            [41.31117339978456, 69.15274345423578],
                            [41.3128259127436, 69.1533967314782],
                            [41.30987639683839, 69.14796257608991],
                            [41.3099674477869, 69.1474976566908],
                            [41.3101583487167, 69.14724540778363],
                            [41.31034497520485, 69.14715816381155],
                            [41.31061565389478, 69.14718661293287],
                            [41.31097038374992, 69.14732885854822],
                            [41.31121541689311, 69.14748627701955],
                            [41.31145617531498, 69.14777076823194],
                            [41.311676988461706, 69.14775749197533],
                            [41.31174964294645, 69.14763990227384],
                            [41.31178810705266, 69.14751662274809],
                            [41.31184509087198, 69.14737058392528],
                            [41.312192691102595, 69.14733834158588],
                            [41.31307592924276, 69.14695901995087],
                            [41.313614413719876, 69.1464886611298],
                            [41.31373692543759, 69.14666694229011],
                            [41.31372552900845, 69.14688315561219],
                            [41.31364290483757, 69.14701591817838],
                            [41.31323548067051, 69.14718661290634],
                            [41.31313861021412, 69.14736489406665],
                            [41.3132012911141, 69.1475545548755],
                            [41.31329103866143, 69.14763041919903],
                            [41.313437768512316, 69.14758869382108],
                            [41.31357737524828, 69.14742368891739],
                            [41.31370273614417, 69.14738386014753],
                            [41.31380387941856, 69.14745024143063],
                            [41.3138067285226, 69.14744644821445],
                            [41.313822398592634, 69.14757731417255],
                            [41.31370416069843, 69.14799836116819],
                            [41.31376541650173, 69.14816336607188],
                            [41.31390502254509, 69.14822216094288],
                            [41.31440076401488, 69.14822785077006],
                            [41.314705614650386, 69.14835113029581],
                            [41.315335254918736, 69.14910218714431],
                            [41.31547343308314, 69.14956495954655],
                            [41.31563725216771, 69.14967875603186],
                            [41.316054632856435, 69.14973186106653],
                            [41.31869845660948, 69.1514862236405],
                            [41.31901040933691, 69.15175554198906],
                            [41.31953887380718, 69.1519148570891],
                            [41.32000750852172, 69.15220883136537],
                            [41.320306635302934, 69.15251228868055],
                            [41.32044195410663, 69.15278919346147],
                            [41.32042201240583, 69.15324627601079],
                            [41.32056587739615, 69.15348714523802],
                            [41.320587243456735, 69.15379060253217],
                            [41.320481837489886, 69.15402198871895],
                            [41.320551633351855, 69.15428941045943],
                            [41.32071259088206, 69.15435389520522],
                            [41.320799479289164, 69.1542590648008],
                            [41.32087497240128, 69.15400491931695],
                            [41.320920553105886, 69.15369766880661],
                            [41.321021685180376, 69.15356680284852],
                            [41.321129939058046, 69.15356490624042],
                            [41.3212524366576, 69.1537071518551],
                            [41.32141196806022, 69.15405423113528],
                            [41.32154016265434, 69.15419458013382],
                            [41.32214124951369, 69.15432734270345],
                            [41.32238054321917, 69.1545245899593],
                            [41.32251016026976, 69.1545056238784],
                            [41.322686780890734, 69.15436148166368],
                            [41.32337382138504, 69.15352341094446],
                            [41.32357626074237, 69.15351134100577],
                            [41.32400228777984, 69.15378626742609],
                            [41.32433162592283, 69.15389288523605],
                            [41.32461463382407, 69.15390227297165],
                            [41.325012454236074, 69.1536340520723],
                            [41.325153453291044, 69.15344093303288],
                            [41.32525013818095, 69.15346775512168],
                            [41.32536092277427, 69.15363941649008],
                            [41.32541732213126, 69.15397737480912],
                            [41.32581815903176, 69.15441725709076],
                            [41.32595714209812, 69.15465060926341],
                            [41.32609209638606, 69.15464256263677],
                            [41.32639221760662, 69.15441993929964],
                            [41.32658759780445, 69.15445212582188],
                            [41.327282501978104, 69.15493224123537],
                            [41.327415439320944, 69.15516291119916],
                            [41.32741141092058, 69.15542576766951],
                            [41.33099930770814, 69.15596804323215],
                            [41.33186938848176, 69.15890774416592],
                            [41.32135714872845, 69.1569577783093],
                            [41.335176114857624, 69.16345140601604],
                            [41.33748810045237, 69.16417023842412],
                            [41.34761823312181, 69.16507741691082],
                            [41.35146810937243, 69.16607882608515],
                            [41.35436106178949, 69.16732300114327],
                            [41.35721971911079, 69.16950789366115],
                            [41.36065905284953, 69.17361974025933],
                            [41.39787649893043, 69.23256631964776],
                            [41.39859254828139, 69.2377138971002],
                            [41.39770881119321, 69.25870163433737],
                            [41.39675273839119, 69.26225208467892],
                            [41.394112083306126, 69.26677359836172],
                            [41.38400375677169, 69.2851631132556],
                            [41.38373053695672, 69.29608757584496],
                            [41.38474803018706, 69.30870241374059],
                            [41.38478022900689, 69.31501096902909],
                            [41.38362106144854, 69.318015042976],
                            [41.38281607160671, 69.3187875199725],
                            [41.37695544677317, 69.32140535584051],
                            [41.37019253110642, 69.32453817581373],
                            [41.35608475851734, 69.34350675797342],
                            [41.35612502470267, 69.34639281588272],
                            [41.355891480052705, 69.3477661068299],
                            [41.354900919292014, 69.3511671476912],
                            [41.35497339985885, 69.3536455086974],
                            [41.35532774815197, 69.35522264793994],
                            [41.35610891821919, 69.35670322724235],
                            [41.35701892925883, 69.35775465312375],
                            [41.36195531615206, 69.36188525488689],
                            [41.36254314803729, 69.36294740960385],
                            [41.362768616392565, 69.36405247966287],
                            [41.36276861642081, 69.36553305940441],
                            [41.36149632046715, 69.37513536747126],
                            [41.36620691210505, 69.3904829674201],
                            [41.36644041977044, 69.39430243317938],
                            [41.36460051792014, 69.40351313898941],
                            [41.35520694779226, 69.41110915492376],
                            [41.34956540262505, 69.41227939227906],
                            [41.346603401581696, 69.41148705452034],
                            [41.34369568835397, 69.40934665177375],
                            [41.34181889588669, 69.40711505385244],
                            [41.33770749987126, 69.39800461291283],
                            [41.337244305351255, 69.39563890442709],
                            [41.33712347146519, 69.39405640118721],
                            [41.33842568243215, 69.38563902951732],
                            [41.33764430015553, 69.38141723243099],
                            [41.33735430023336, 69.38076813788174],
                            [41.336999854130546, 69.38014586542133],
                            [41.33624664975767, 69.37945921994775],
                            [41.33550552037598, 69.37908907512214],
                            [41.33501814260533, 69.3788530407074],
                            [41.3336284918884, 69.37790890318124],
                            [41.33095383427374, 69.37562366111493],
                            [41.33032543488392, 69.37494774434127],
                            [41.314980136673526, 69.3530287321377],
                            [41.31377943326297, 69.35085077852621],
                            [41.31321936600974, 69.35027142124893],
                            [41.312054894324476, 69.35015340405815],
                            [41.30997571663996, 69.34986372549977],
                            [41.308851482485196, 69.34931655485991],
                            [41.30785617655605, 69.34859235843527],
                            [41.30771514007857, 69.3485869940175],
                            [41.30760231067695, 69.34861381610631],
                            [41.30747739218313, 69.34866746028392],
                            [41.30735247344995, 69.34873719771484],
                            [41.30727591023713, 69.34893031675428],
                            [41.30541821736155, 69.35973961854535],
                            [41.305097850594265, 69.36022466694692],
                            [41.30472912470435, 69.36030781542223],
                            [41.304428903724, 69.36032927309328],
                            [41.303071538368705, 69.36060793335784],
                            [41.30224244933921, 69.36118845910099],
                            [41.301830297113156, 69.36185191709315],
                            [41.30166255999632, 69.36264296316072],
                            [41.30167214499658, 69.36335745666679],
                            [41.302103468076226, 69.3670511314501],
                            [41.30202199615151, 69.36870977665951],
                            [41.30179195724331, 69.3695199609384],
                            [41.30137021713745, 69.37055342434927],
                            [41.30071843157347, 69.37091067100592],
                            [41.29971198524228, 69.37179102872629],
                            [41.29911769535362, 69.36981341355734],
                            [41.298590498129975, 69.36870339721528],
                            [41.297699045937705, 69.36674492025764],
                            [41.29266642595783, 69.37123602057049],
                            [41.292263799589094, 69.37031738642749],
                            [41.29168621813758, 69.37090429157439],
                            [41.29034803318072, 69.37088057604322],
                            [41.28960699541881, 69.36906741871067],
                            [41.28974950329716, 69.3672390882525],
                            [41.289578493761105, 69.36657148220537],
                            [41.28958989441078, 69.3661238826965],
                            [41.287532044869984, 69.36008508254295],
                            [41.272052260602436, 69.36259036363357],
                            [41.27012500470334, 69.36391040286313],
                            [41.2683915661852, 69.36620150543395],
                            [41.268517013938556, 69.36676290142812],
                            [41.26831173567122, 69.3673242974223],
                            [41.267798537179246, 69.36765810044587],
                            [41.26814066995542, 69.36944849848135],
                            [41.27019342898236, 69.37439485293429],
                            [41.27278209415629, 69.37738390728164],
                            [41.27388823255344, 69.37926534250536],
                            [41.27407068657073, 69.3801453686584],
                            [41.27372858486997, 69.38113160486438],
                            [41.26948637483286, 69.38163230939973],
                            [41.26639577397103, 69.38316476899016],
                            [41.265677273869684, 69.3842420423844],
                            [41.26543777207899, 69.38639658917286],
                            [41.265859750871165, 69.39023532440379],
                            [41.2659711869282, 69.39571272841029],
                            [41.26561763794833, 69.39721484201634],
                            [41.264864914389186, 69.39748795358108],
                            [41.262971662231784, 69.39539409825144],
                            [41.25412055050454, 69.38401445001442],
                            [41.248112496159145, 69.3917601979328],
                            [41.24679487116393, 69.3926781562476],
                            [41.24585939832877, 69.39313334218883],
                            [41.24511785542284, 69.3933533487263],
                            [41.24511215121438, 69.3933533487263],
                            [41.24421658430905, 69.393368521591],
                            [41.243355231311405, 69.39308023716156],
                            [41.242493866960196, 69.39242021754679],
                            [41.24195764760717, 69.39178295705464],
                            [41.23911104802721, 69.38725385678026],
                            [41.24295022026684, 69.38291441747391],
                            [41.24231132463093, 69.38018330182656],
                            [41.24420517565263, 69.37463003334364],
                            [41.24452461499363, 69.37226306644929],
                            [41.24415954133358, 69.36971402517842],
                            [41.24283613221853, 69.36622426629572],
                            [41.239504673327424, 69.36064065134656],
                            [41.23747376921907, 69.35693847235794],
                            [41.23117528317946, 69.35141554910506],
                            [41.2284594443976, 69.34558916905739],
                            [41.22318719990103, 69.33372398796504],
                            [41.219124314511184, 69.32364920449366],
                            [41.20974219383034, 69.29779464186569],
                            [41.20419446768675, 69.27940512984027],
                            [41.191955844704864, 69.2564334110558],
                            [41.188598956680096, 69.26031766457369],
                            [41.18674916944321, 69.26137976510321],
                            [41.182958084162365, 69.25764724038518],
                            [41.1711723452077, 69.24866490418486],
                            [41.16623815022512, 69.24578205936245],
                            [41.16621530586382, 69.2375280205047],
                            [41.1669234772655, 69.23337065557486],
                            [41.170395690790514, 69.22229446433842],
                            [41.1740961369303, 69.210307900354],
                            [41.17706547958292, 69.20381391396724],
                            [41.182364279593116, 69.19862479423729],
                            [41.1924125505498, 69.18949072900713],
                            [41.19636292582258, 69.18657753844921],
                            [41.19999340708355, 69.18502990624904],
                            [41.20318989064202, 69.18554578367936],
                            [41.20857745083762, 69.18848931947501],
                            [41.21382804522278, 69.19301083315781],
                            [41.22241071834284, 69.19992965984567],
                            [41.22473880241157, 69.20014207995158],
                            [41.22706680359816, 69.19765373013955],
                            [41.227454795737906, 69.19373913104504],
                            [41.226039754468076, 69.18809482537385],
                            [41.227454795737906, 69.18196498803205],
                            [41.228915451500285, 69.17680621330688],
                            [41.229554478082605, 69.17395371474187],
                            [41.234118772032204, 69.16976600408262],
                            [41.23500877222371, 69.1685218291766],
                            [41.23548514555255, 69.16653797711609],
                            [41.23573331472042, 69.1657110559075],
                            [41.235720478407615, 69.1651193141839],
                            [41.235785707706064, 69.16466935839502]
                        ]
                        
                        var myPolygon = new ymaps.Polygon([polygonCoordinates], {}, {
                            fillColor: '#000080',
                            strokeColor: '#008000',
                            strokeWidth: 3,
                            fillOpacity: 0
                        });
                       
                        map.geoObjects.add(myPolygon);

                        const validLocationRegex = /^-?\d+(\.\d+)?, ?-?\d+(\.\d+)?$/;

                        const crimeMarkers = data2.filter(item => validLocationRegex.test(item["Содир этилган жиноятнинг локацияси"]))
                        .map(item => {
                            const coords = item["Содир этилган жиноятнинг локацияси"]
                            .split(',').map(coord => parseFloat(coord.trim()));
                            return {
                            coords: coords,
                            title: `Жиноят: ${item["Ҳужжат id"]}`,
                            color: "red"
                            };
                        });

                        var clusterer = new ymaps.Clusterer({
                            preset: 'islands#invertedRedClusterIcons', // markerlar guruhi uchun dizayn
                            groupByCoordinates: false,
                            clusterDisableClickZoom: false,
                            clusterOpenBalloonOnClick: false
                        });

                        // Har bir marker uchun Placemark yaratish
                        var placemarks = crimeMarkers.map(function (point) {
                            var placemark = new ymaps.Placemark(point.coords, {
                                hintContent: point.title,
                                balloonContent: point.title
                            }, {
                                preset: point.color === "red" ? 'islands#redIcon' : 'islands#blueIcon'
                            });

                            // 🔍 Markerga klik qilinganda fokuslash
                            placemark.events.add('click', function () {
                                map.setCenter(point.coords, 20, {
                                    checkZoomRange: true
                                });
                            });

                            return placemark;
                        });

                        // Markerlarni klasterga qo‘shish
                        clusterer.add(placemarks);
                        // map.geoObjects.add(clusterer);
                    }                
                </script>
                </div>
            </div>

            <!-- Other Cards (Hidden by Default) -->
            <div class="dashboard-card d-none" id="demographic">
                <div class="card-header">
                    <h2 class="card-title">Демографик маълумотлар</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="chart-container">
                                <canvas id="populationChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">2,694,400</div>
                                    <div class="stat-label">Аҳоли сони</div>
                                    <div class="stat-trend">
                                        <i class="fas fa-arrow-up text-success"></i>
                                        <span class="badge bg-success">+1.8%</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">1.29M</div>
                                    <div class="stat-label">Эркаклар</div>
                                    <div class="stat-trend">
                                        <i class="fas fa-mars text-primary"></i>
                                        <span>48%</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">1.40M</div>
                                    <div class="stat-label">Аёллар</div>
                                    <div class="stat-trend">
                                        <i class="fas fa-venus text-danger"></i>
                                        <span>52%</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">23.5</div>
                                    <div class="stat-label">Ўртача ёш</div>
                                    <div class="stat-trend">
                                        <i class="fas fa-user-clock text-warning"></i>
                                        <span>+0.3 йил</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h5>Туманлар бўйича аҳоли</h5>
                                <ul class="custom-list">
                                    <li class="list-item">
                                        <div>Мирзо Улуғбек</div>
                                        <strong>365,200</strong>
                                    </li>
                                    <li class="list-item">
                                        <div>Юнусобод</div>
                                        <strong>341,800</strong>
                                    </li>
                                    <li class="list-item">
                                        <div>Шайхонтохур</div>
                                        <strong>298,500</strong>
                                    </li>
                                    <li class="list-item">
                                        <div>Олмазор</div>
                                        <strong>276,300</strong>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            // Population Chart
                            const popCtx = document.getElementById('populationChart').getContext('2d');
                            const popChart = new Chart(popCtx, {
                                type: 'bar',
                                data: {
                                    labels: ['0-14', '15-24', '25-54', '55-64', '65+'],
                                    datasets: [{
                                        label: 'Эркаклар',
                                        data: [320000, 280000, 450000, 150000, 90000],
                                        backgroundColor: 'rgba(37, 99, 235, 0.7)',
                                        borderColor: 'rgba(37, 99, 235, 1)',
                                        borderWidth: 1
                                    }, {
                                        label: 'Аёллар',
                                        data: [310000, 290000, 470000, 170000, 120000],
                                        backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                        borderColor: 'rgba(239, 68, 68, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Ёш гуруҳлари бўйича аҳоли тақсимоти',
                                            color: '#f1f5f9'
                                        },
                                        legend: {
                                            labels: {
                                                color: '#f1f5f9'
                                            }
                                        }
                                    },
                                    scales: {
                                        x: {
                                            ticks: {
                                                color: '#94a3b8'
                                            },
                                            grid: {
                                                color: 'rgba(148, 163, 184, 0.1)'
                                            }
                                        },
                                        y: {
                                            ticks: {
                                                color: '#94a3b8'
                                            },
                                            grid: {
                                                color: 'rgba(148, 163, 184, 0.1)'
                                            }
                                        }
                                    }
                                }
                            });
                        });
                    </script>
                </div>
            </div>

            <div class="dashboard-card" id="monitoring">
                <div class="card-header">
                    <h2 class="card-title">Хавф мониторинги</h2>
                </div>
                <div class="card-body row">
                    <div class="d-none col-12">
                        <div class="col-1"><span>Bektemir</span></div>
                        <div class="col-1"><span>Olmazor</span></div>
                        <div class="col-1"><span>Uchtepa</span></div>
                        <div class="col-1"><span>Mirobod</span></div>
                        <div class="col-1"><span>Sergeli</span></div>
                        <div class="col-1"><span>Yunusobod</span></div>
                        <div class="col-1"><span>Yangihayot</span></div>
                        <div class="col-1"><span>Shayhontohur</span></div>
                        <div class="col-1"><span>Chilonzor</span></div>
                        <div class="col-1"><span>Yakkasaroy</span></div>
                        <div class="col-1"><span>Yashnaobod</span></div>
                        <div class="col-1"><span>Mirzo Ulug'bek</span></div>
                    </div>
                    <div class="col-8">
                        <div class="mx-auto d-flex gap-2 px-5">
                            <select id="yearSelect" class="form-control"></select>
                            <select id="monthSelect" class="form-control">
                                <option value="01">Yanvar</option>
                                <option value="02">Fevral</option>
                                <option value="03">Mart</option>
                                <option value="04">Aprel</option>
                                <option value="05">May</option>
                                <option value="06">Iyun</option>
                                <option value="07">Iyul</option>
                                <option value="08">Avgust</option>
                                <option value="09">Sentabr</option>
                                <option value="10">Oktabr</option>
                                <option value="11">Noyabr</option>
                                <option value="12">Dekabr</option>
                            </select>
                            <button id="resetChartBtn" class="btn btn-outline-primary align-items-center gap-2" style="display: none;"><i class="fa-solid fa-reply mr-2"></i> Ortga</button>
                        </div>                        
                        <div id="crime_types_date"></div>
                    </div>
                    <div class="col-4">
                        <div id="chilonzor_map" style="width: 100%; height: 600px;"></div>
                    </div>
                    <!-- chartda bar click bolganda dates ochiladi, xatolik: selector tanlanganda ortga qaytayabdi shuni to'g'irlash kerak -->
                    <script>
                        const yearSelect = document.getElementById('yearSelect');
                        const monthSelect = document.getElementById('monthSelect');
                        const resetBtn = document.getElementById('resetChartBtn');

                        let chart;
                        let fullMonthlyData = []; // to‘liq oylik ma’lumotlar

                        const years = [...new Set(data3.map(d => d.date.split('.')[2]))];
                        years.sort();
                        years.forEach(year => {
                            const option = document.createElement('option');
                            option.value = year;
                            option.textContent = year;
                            yearSelect.appendChild(option);
                        });

                        function renderChart(filteredData) {
                            fullMonthlyData = filteredData; // reset uchun saqlaymiz

                            const dates = [...new Set(filteredData.map(item => item.date))].sort((a, b) => {
                                const [dayA, monthA, yearA] = a.split('.').map(Number);
                                const [dayB, monthB, yearB] = b.split('.').map(Number);
                                return new Date(yearA, monthA - 1, dayA) - new Date(yearB, monthB - 1, dayB);
                            });

                            const daysOnly = dates.map(d => d.split('.')[0]); // faqat kunlar

                            const crimeTypes = [...new Set(filteredData.map(item => item.crime_type))];

                            const series = crimeTypes.map(type => {
                                return {
                                    name: type,
                                    data: dates.map(date => {
                                        return filteredData.filter(item => item.date === date && item.crime_type === type).length;
                                    })
                                };
                            });

                            const totalPerDate = dates.map(date => {
                                return filteredData.filter(item => item.date === date).length;
                            });

                            const options = {
                                chart: {
                                    type: 'bar',
                                    stacked: true,
                                    height: 600,
                                    toolbar: { show: false },
                                    events: {
                                        dataPointSelection: function(event, chartContext, config) {
                                            const crimeType = chartContext.w.globals.seriesNames[config.seriesIndex];
                                            const selectedYear = yearSelect.value;
                                            const selectedMonth = monthSelect.value;

                                            const filtered = data3.filter(item => {
                                                const [day, month, year] = item.date.split('.');
                                                return year === selectedYear && month === selectedMonth && item.crime_type === crimeType;
                                            });

                                            const grouped = {};
                                            filtered.forEach(item => {
                                                if (!grouped[item.date]) grouped[item.date] = 0;
                                                grouped[item.date]++;
                                            });

                                            const dates = Object.keys(grouped).sort((a, b) => {
                                                const [dayA, monthA, yearA] = a.split('.').map(Number);
                                                const [dayB, monthB, yearB] = b.split('.').map(Number);
                                                return (new Date(yearA, monthA - 1, dayA) - new Date(yearB, monthB - 1, dayB));
                                            });

                                            const chartData = [{
                                                name: crimeType,
                                                data: dates.map(date => grouped[date])
                                            }];
                                            
                                            chart.updateOptions({
                                                series: chartData,
                                                xaxis: { categories: dates.map(item => item.split('.')[0]) }
                                            });

                                            resetBtn.style.display = 'flex';
                                        }
                                    }
                                },
                                xaxis: {
                                    categories: daysOnly,
                                    labels: { 
                                        style: { colors: '#fff' },
                                        rotate: -45
                                    }
                                },
                                yaxis: {
                                    labels: { style: { colors: '#fff' } }
                                },
                                legend: {
                                    show: false
                                },
                                dataLabels: {
                                    enabled: true,
                                    style: { colors: ['#fff'] },
                                    formatter: val => val,
                                    background: { enabled: false },
                                    dropShadow: { enabled: false },
                                    total: {
                                        enabled: true,
                                        style: {
                                            fontSize: '12px',
                                            fontWeight: 600,
                                            color: '#fff'
                                        }
                                    }
                                },
                                tooltip: {
                                    shared: false,
                                    intersect: true,
                                    custom: function({ series, seriesIndex, dataPointIndex, w }) {
                                        const date = dates[dataPointIndex];
                                        const crimeType = w.globals.seriesNames[seriesIndex];
                                        const color = w.globals.colors[seriesIndex];

                                        const count = data3.filter(d => d.date === date && d.crime_type === crimeType).length;

                                        return `
                                            <div style="padding:10px; border-left: 10px solid ${color};">
                                                <span class='text-dark'><strong>Jinoyat turi:</strong> ${crimeType}</span><br/>
                                                <span class='text-dark'><strong>Jinoyat soni:</strong> ${count} ta</span><br/>
                                                <span class='text-dark'><strong>Sana:</strong> ${date}</span>                                                
                                            </div>`;
                                    }
                                },
                                series: series
                            };

                            if (chart) {
                                chart.updateOptions(options);
                            } else {
                                chart = new ApexCharts(document.querySelector("#crime_types_date"), options);
                                chart.render();
                            }

                            resetBtn.style.display = 'none'; // grafikka qaytganda tugma yashiriladi
                        }

                        function updateChart() {
                            const selectedYear = yearSelect.value;
                            const selectedMonth = monthSelect.value;

                            const filtered = data3
                                .filter(item => {
                                    const [day, month, year] = item.date.split('.');
                                    return year === selectedYear && month === selectedMonth;
                                })
                                .map(item => ({
                                    date: item.date,
                                    crime_type: item.crime_type
                                }));

                            if (filtered.length > 0) {
                                renderChart(filtered);
                            }
                        }

                        resetBtn.addEventListener('click', () => {
                            renderChart(fullMonthlyData); // reset qilish
                        });

                        yearSelect.addEventListener('change', updateChart);
                        monthSelect.addEventListener('change', updateChart);

                        yearSelect.selectedIndex = 0;
                        updateChart();
                        // =============================================================
                         </script>
                </div>
            </div>

            <!-- Personal Control Card -->
            <div class="dashboard-card d-none" id="personal">
                <div class="card-header">
                    <h2 class="card-title">Шахсий назорат</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="stat-card mb-4">
                                <div class="stat-value">1,248</div>
                                <div class="stat-label">Назоратдаги шахслар</div>
                                <div class="stat-trend">
                                    <i class="fas fa-arrow-up text-warning"></i>
                                    <span class="badge bg-warning">+2.3%</span>
                                </div>
                            </div>
                            
                            <ul class="custom-list">
                                <li class="list-item">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-user-clock text-primary me-2"></i>
                                        <span>Профилактикадаги шахслар</span>
                                    </div>
                                    <strong>892</strong>
                                </li>
                                <li class="list-item">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-user-shield text-success me-2"></i>
                                        <span>Назоратдаги оилавий зўравонлик</span>
                                    </div>
                                    <strong>156</strong>
                                </li>
                                <li class="list-item">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-user-graduate text-info me-2"></i>
                                        <span>Ижтимоий ишлардаги шахслар</span>
                                    </div>
                                    <strong>200</strong>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-container">
                                <canvas id="personalChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Administrative Violations Card -->
            <div class="dashboard-card d-none" id="maHuq">
                <div class="card-header">
                    <h2 class="card-title">Маъмурий ҳуқуқбузарликлар</h2>
                </div>
                <div class="card-body">
                    <div class="stats-grid mb-4">
                        <div class="stat-card">
                            <div class="stat-value">1,128</div>
                            <div class="stat-label">Жами аниқланган ҳуқуқбузарликлар</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">221</div>
                            <div class="stat-label">Профилактика инспектори томонидан</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">147</div>
                            <div class="stat-label">Суд томонидан кўриб чиқилган</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <h5 class="mb-3">Жарималар</h5>
                            <div class="progress-wrapper">
                                <div class="circle">
                                    <svg>
                                        <circle class="circle-bg" cx="30" cy="30" r="25" />
                                        <circle class="circle-bar" cx="30" cy="30" r="25" />
                                    </svg>
                                    <div class="circle-text">68%</div>
                                </div>
                                <div>
                                    <div class="fw-bold">Жарима солинган</div>
                                    <small class="text-secondary">767 та</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h5 class="mb-3">Огоҳлантириш</h5>
                            <div class="progress-wrapper">
                                <div class="circle">
                                    <svg>
                                        <circle class="circle-bg" cx="30" cy="30" r="25" />
                                        <circle class="circle-bar" cx="30" cy="30" r="25" />
                                    </svg>
                                    <div class="circle-text">22%</div>
                                </div>
                                <div>
                                    <div class="fw-bold">Огоҳлантирилган</div>
                                    <small class="text-secondary">248 та</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h5 class="mb-3">Маъмурий қамоқ</h5>
                            <div class="progress-wrapper">
                                <div class="circle">
                                    <svg>
                                        <circle class="circle-bg" cx="30" cy="30" r="25" />
                                        <circle class="circle-bar" cx="30" cy="30" r="25" />
                                    </svg>
                                    <div class="circle-text">10%</div>
                                </div>
                                <div>
                                    <div class="fw-bold">Қамоққа олинган</div>
                                    <small class="text-secondary">113 та</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- E-Material Monitoring Card -->
            <div class="dashboard-card d-none" id="e-ma-mo">
                <div class="card-header">
                    <h2 class="card-title">E-материал мониторинги</h2>
                </div>
                <div class="card-body">
                    <ul class="custom-list">
                        <li class="list-item">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-envelope bg-primary p-2 rounded-circle me-3"></i>
                                <div>
                                    <div class="fw-bold">Келиб тушган хабарлар</div>
                                    <small class="text-secondary">Охирги 24 соатда</small>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold">203</div>
                                <small class="text-danger">
                                    <i class="fas fa-arrow-trend-up"></i> +127.9%
                                </small>
                            </div>
                        </li>
                        <li class="list-item">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-phone bg-success p-2 rounded-circle me-3"></i>
                                <div>
                                    <div class="fw-bold">Қўзғатилган ишлар</div>
                                    <small class="text-secondary">Охирги 7 кунда</small>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold">156</div>
                                <small class="text-success">
                                    <i class="fas fa-arrow-trend-down"></i> -27.9%
                                </small>
                            </div>
                        </li>
                        <li class="list-item">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-file bg-info p-2 rounded-circle me-3"></i>
                                <div>
                                    <div class="fw-bold">Судга юборилган ҳужжатлар</div>
                                    <small class="text-secondary">Охирги 30 кунда</small>
                                </div>
                            </div>
                            <div class="fw-bold">87</div>
                        </li>
                        <li class="list-item">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-camera bg-warning p-2 rounded-circle me-3"></i>
                                <div>
                                    <div class="fw-bold">Жиноят ишини қўзғатишни рад этиш</div>
                                    <small class="text-secondary">Охирги 7 кунда</small>
                                </div>
                            </div>
                            <div class="fw-bold">23</div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Prophylactic Measures Card -->
            <div class="dashboard-card d-none" id="prophylactic">
                <div class="card-header">
                    <h2 class="card-title">Профилактик тадбирлар</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>17:00 - 19:00 оралиғида патрул кучайтириш</strong>
                        <p class="mb-0 mt-1">Бешқўрғон МФЙ ҳудудида доимий назорат</p>
                    </div>
                    
                    <h5 class="mt-4 mb-3">Яқиндаги тадбирлар</h5>
                    <ul class="custom-list">
                        <li class="list-item">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar-check text-primary me-3"></i>
                                <div>
                                    <div class="fw-bold">Ижтимоий хавфсизлик машғулотлари</div>
                                    <small class="text-secondary">2023-11-15, 10:00</small>
                                </div>
                            </div>
                            <span class="badge bg-success">Бажарилди</span>
                        </li>
                        <li class="list-item">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar-day text-info me-3"></i>
                                <div>
                                    <div class="fw-bold">Ёшлар билан ишлаш бўйича семинар</div>
                                    <small class="text-secondary">2023-11-20, 14:00</small>
                                </div>
                            </div>
                            <span class="badge bg-warning">Режалаштирилган</span>
                        </li>
                        <li class="list-item">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar-alt text-success me-3"></i>
                                <div>
                                    <div class="fw-bold">Махалла хавфсизлиги кенгаши</div>
                                    <small class="text-secondary">2023-11-25, 09:30</small>
                                </div>
                            </div>
                            <span class="badge bg-primary">Яқинлашмокда</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Structural Platforms Card -->
            <div class="dashboard-card d-none" id="statistic">
                <div class="card-header">
                    <h2 class="card-title">Таркибий платформалар</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <a href="m24-admin/index.html" class="text-decoration-none">
                                <div class="platform-card bg-primary">
                                    <img src="images/mahalla.png" alt="Mahalla 24" class="platform-icon">
                                    <h5>Маҳалла 24</h5>
                                    <p>Махаллабай ишлаш тизими</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 mb-4">
                            <a href="prob24/dashboard.html" class="text-decoration-none">
                                <div class="platform-card bg-success">
                                    <img src="images/prob.png" alt="Digital Probation" class="platform-icon">
                                    <h5>Рақамли Пробация</h5>
                                    <p>Пробация хизмати тизими</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 mb-4">
                            <a href="stat-crm/index.html" class="text-decoration-none">
                                <div class="platform-card bg-warning">
                                    <img src="images/Yoshlar.png" alt="Youth Work" class="platform-icon">
                                    <h5>Ёшлар билан ишлаш</h5>
                                    <p>Ёшлар ижтимоий хавфсизлиги</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- JavaScript for Interactive Functionality -->
            <script>
                // Initialize sidebar toggle functionality
                document.getElementById('sidebarToggle').addEventListener('click', function() {
                    const sidebar = document.getElementById('sidebar');
                    sidebar.classList.toggle('collapsed');
                    
                    // Change icon based on state
                    if (sidebar.classList.contains('collapsed')) {
                        this.innerHTML = '<i class="fas fa-chevron-right"></i>';
                    } else {
                        this.innerHTML = '<i class="fas fa-chevron-left"></i>';
                    }
                });

                // Mobile sidebar toggle
                document.getElementById('sidebarToggleMobile').addEventListener('click', function() {
                    document.getElementById('sidebar').classList.toggle('open');
                });

                // Card navigation from sidebar
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', function() {
                        // Remove active class from all nav items
                        document.querySelectorAll('.nav-item').forEach(nav => {
                            nav.classList.remove('active');
                        });
                        
                        // Add active class to clicked item
                        this.classList.add('active');
                        
                        // Hide all cards
                        document.querySelectorAll('.dashboard-card').forEach(card => {
                            card.classList.add('d-none');
                        });
                        
                        // Show selected card
                        const cardId = this.getAttribute('data-card');
                        document.getElementById(cardId).classList.remove('d-none');
                    });
                });

                // Initialize charts
                // document.addEventListener('DOMContentLoaded', function() {

                //     if (document.getElementById('Tmap')) {
                //     ymaps.ready(init);
                    
                //     function init() {
                //         var map = new ymaps.Map("Tmap", {
                //             center: [41.2995, 69.2401], // Toshkent markazi
                //             zoom: 11,
                //             controls: ['zoomControl', 'typeSelector', 'fullscreenControl']
                //         });
                        
                //         // Turli xil hududlar uchun belgilar
                //         var districts = [
                //             {coords: [41.2825, 69.2163], name: "Мирзо Улуғбек тумани", crime: 23},
                //             {coords: [41.3389, 69.2847], name: "Юнусобод тумани", crime: 18},
                //             {coords: [41.3111, 69.2795], name: "Шайхонтохур тумани", crime: 31},
                //             {coords: [41.2928, 69.1397], name: "Олмазор тумани", crime: 15},
                //             {coords: [41.3573, 69.2664], name: "Яшнобод тумани", crime: 12}
                //         ];
                        
                //         districts.forEach(function(district) {
                //             var color = district.crime > 25 ? '#ef4444' : 
                //                        district.crime > 15 ? '#f59e0b' : '#10b981';
                            
                //             var placemark = new ymaps.Placemark(district.coords, {
                //                 balloonContent: `<strong>${district.name}</strong><br>Жиноятлар: ${district.crime}`
                //             }, {
                //                 preset: 'islands#circleIcon',
                //                 iconColor: color
                //             });
                            
                //             map.geoObjects.add(placemark);
                //         });
                        
                //         // Kameralar joylashuvi
                //         var cameras = [
                //             [41.2925, 69.2263], [41.2989, 69.2447], [41.3011, 69.2595],
                //             [41.3228, 69.2397], [41.3173, 69.2164], [41.2875, 69.1963]
                //         ];
                        
                //         cameras.forEach(function(camera) {
                //             var cameraPlacemark = new ymaps.Placemark(camera, {}, {
                //                 preset: 'islands#videoCameraIcon',
                //                 iconColor: '#2563eb'
                //             });
                //             map.geoObjects.add(cameraPlacemark);
                //         });
                //     }
                // }
                    // Crime Chart
                    // const crimeCtx = document.getElementById('crimeChart').getContext('2d');
                    // const crimeChart = new Chart(crimeCtx, {
                    //     type: 'line',
                    //     data: {
                    //         labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл'],
                    //         datasets: [{
                    //             label: 'Жиноятлар сони',
                    //             data: [65, 59, 80, 81, 56, 55, 40],
                    //             backgroundColor: 'rgba(37, 99, 235, 0.2)',
                    //             borderColor: 'rgba(37, 99, 235, 1)',
                    //             borderWidth: 2,
                    //             tension: 0.4,
                    //             fill: true
                    //         }]
                    //     },
                    //     options: {
                    //         responsive: true,
                    //         plugins: {
                    //             legend: {
                    //                 display: false
                    //             }
                    //         },
                    //         scales: {
                    //             y: {
                    //                 beginAtZero: true
                    //             }
                    //         }
                    //     }
                    // });

                    // Personal Chart
                    const personalCtx = document.getElementById('personalChart').getContext('2d');
                    const personalChart = new Chart(personalCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Профилактикадаги', 'Оилавий зўравонлик', 'Ижтимоий ишлардаги'],
                            datasets: [{
                                data: [892, 156, 200],
                                backgroundColor: [
                                    'rgba(37, 99, 235, 0.7)',
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(59, 130, 246, 0.7)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });
                // });

                // Initialize progress circles
                document.querySelectorAll('.circle').forEach(wrapper => {
                    const percent = parseFloat(wrapper.getAttribute('data-percent')) || 75;
                    const circle = wrapper.querySelector('.circle-bar');
                    const radius = circle.r.baseVal.value;
                    const circumference = 2 * Math.PI * radius;
                    const offset = circumference - (percent / 100) * circumference;

                    circle.style.strokeDasharray = circumference;
                    circle.style.strokeDashoffset = offset;
                });
            </script>
            <!-- Updated Map Script Section -->
        </main>
    </div>

    <!-- <footer>
        <div class="f-group d-flex column-gap-3 px-2">
            <a href="index.html">V1</a>
            <a href="index1.html">V2</a>
        </div>        
    </footer> -->
</body>
</html>